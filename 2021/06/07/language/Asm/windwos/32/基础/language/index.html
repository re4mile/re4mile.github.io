<!DOCTYPE html>
<html lang='zh-CN'>

<head>
  <meta name="generator" content="Hexo 6.3.0">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.18.5">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://gcore.jsdelivr.net'>
  <link rel="preconnect" href="https://gcore.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>x86汇编语言基础部分 - re4mile</title>

  
    <meta name="description" content="寄存器段寄存器    寄存器 功能    CS(code segment) 代码段地址寄存器，存放代码段的起始地址   DS(data segment) 数据段地址寄存器，存放数据段的起始地址   SS(stack segment) 堆栈段地址寄存器，存放堆栈段的起始地址   ES(extra segment) 附加段地址寄存器，存放附加段的起始地址   控制寄存器 IP(Instruction">
<meta property="og:type" content="article">
<meta property="og:title" content="x86汇编语言基础部分">
<meta property="og:url" content="https://gitee.com/re4mile/re4mile.git/2021/06/07/language/Asm/windwos/32/%E5%9F%BA%E7%A1%80/language/index.html">
<meta property="og:site_name" content="re4mile">
<meta property="og:description" content="寄存器段寄存器    寄存器 功能    CS(code segment) 代码段地址寄存器，存放代码段的起始地址   DS(data segment) 数据段地址寄存器，存放数据段的起始地址   SS(stack segment) 堆栈段地址寄存器，存放堆栈段的起始地址   ES(extra segment) 附加段地址寄存器，存放附加段的起始地址   控制寄存器 IP(Instruction">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://resmile.gitee.io/blog/Asm-%E5%9F%BA%E7%A1%80/image-20221025005410035.png">
<meta property="og:image" content="https://resmile.gitee.io/blog/Asm-%E5%9F%BA%E7%A1%80/image-20221025005425740.png">
<meta property="og:image" content="https://resmile.gitee.io/blog/Asm-%E5%9F%BA%E7%A1%80/image-20221025005444436.png">
<meta property="article:published_time" content="2021-06-07T01:00:00.000Z">
<meta property="article:modified_time" content="2022-12-29T03:48:05.032Z">
<meta property="article:author" content="邓渠香">
<meta property="article:tag" content="Assembly">
<meta property="article:tag" content="x86">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://resmile.gitee.io/blog/Asm-%E5%9F%BA%E7%A1%80/image-20221025005410035.png">
  
  

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/re4mile/css/main.css">

  

  
    <link rel="shortcut icon" href="https://s1.ax1x.com/2023/01/03/pSip2aF.png">
  

  

  


  
</head>

<body>
  




  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    

  

<header class="header"><div class="logo-wrap"><a class="avatar" href="/re4mile/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://s1.ax1x.com/2022/12/21/zOXq9s.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/image/2659360.svg';"></a><a class="title" href="/re4mile/"><div class="main" ff="title">re4mile</div><div class="sub cap">好记性不如烂笔头</div></a></div>

<nav class="menu dis-select"><a class="nav-item" href="/re4mile/">文章</a><a class="nav-item" href="/re4mile/wiki/">项目</a><a class="nav-item" href="/re4mile/about/">关于</a><a class="nav-item" href="/re4mile/friends/">友链</a></nav>
</header>


<div class="widgets">
<widget class="widget-wrapper search"><div class="widget-body"><div class="search-wrapper" id="search"><form class="search-form"><input type="text" class="search-input" id="search-input" data-filter="/blog/" placeholder="文章搜索"><svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div></div></widget>


<widget class="widget-wrapper toc single" id="data-toc"><div class="widget-header cap dis-select"><span class="name">x86汇编语言基础部分</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#x86%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">x86寄存器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x64%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">x64寄存器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x64%E5%AF%84%E5%AD%98%E5%99%A8%E8%B0%83%E7%94%A8%E7%BA%A6%E5%AE%9A"><span class="toc-text">x64寄存器调用约定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-text">标志寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CF-%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%BA%A2%E5%87%BA"><span class="toc-text">CF 无符号溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PF"><span class="toc-text">PF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AF"><span class="toc-text">AF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ZF"><span class="toc-text">ZF:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SF"><span class="toc-text">SF:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TF"><span class="toc-text">TF:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IF"><span class="toc-text">IF:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DF"><span class="toc-text">DF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OF-%E6%9C%89%E7%AC%A6%E5%8F%B7%E6%BA%A2%E5%87%BA"><span class="toc-text">OF 有符号溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOPF"><span class="toc-text">IOPF :</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NT"><span class="toc-text">NT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RF"><span class="toc-text">RF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VM"><span class="toc-text">VM :</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AC"><span class="toc-text">AC :</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VIF"><span class="toc-text">VIF :</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VIP"><span class="toc-text">VIP:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ID"><span class="toc-text">ID :</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E7%9A%84%E6%8C%87%E4%BB%A4%E5%92%8Cflag"><span class="toc-text">特殊的指令和flag</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MUL-x2F-IMUL"><span class="toc-text">MUL&#x2F;IMUL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#and"><span class="toc-text">and</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#or"><span class="toc-text">or</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xor"><span class="toc-text">xor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#test"><span class="toc-text">test</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%B7%A6%E7%A7%BB-SHL"><span class="toc-text">逻辑左移 SHL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%8F%B3%E7%A7%BB-SHR"><span class="toc-text">逻辑右移 SHR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%9C%AF%E5%B7%A6%E7%A7%BB-SAL"><span class="toc-text">算术左移 SAL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%9C%AF%E5%8F%B3%E7%A7%BBSAR"><span class="toc-text">算术右移SAR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E5%B7%A6%E7%A7%BB-ROL"><span class="toc-text">循环左移 ROL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E5%8F%B3%E7%A7%BB-ROR"><span class="toc-text">循环右移 ROR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E8%BF%9B%E4%BD%8D%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%B7%A6%E7%A7%BB-RCL"><span class="toc-text">带进位的循环左移 RCL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E8%BF%9B%E4%BD%8D%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%8F%B3%E7%A7%BB-RCR"><span class="toc-text">带进位的循环右移 RCR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B2%E6%AF%94%E8%BE%83-CMPSB-x2F-CMPSW"><span class="toc-text">串比较 CMPSB &#x2F; CMPSW</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B2%E6%89%AB%E6%8F%8F-SCASB-x2F-SCASW"><span class="toc-text">串扫描 SCASB &#x2F; SCASW</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%BD%B1%E5%93%8D"><span class="toc-text">不影响</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8%E6%9C%89%E5%85%B3%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-text">与标志寄存器有关的指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LAHF"><span class="toc-text">LAHF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SAHF"><span class="toc-text">SAHF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pushf-x2F-pushfd"><span class="toc-text">pushf&#x2F;pushfd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#popf-x2F-popfd"><span class="toc-text">popf&#x2F;popfd</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E9%A2%91"><span class="toc-text">高频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-text">全局变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#x68"><span class="toc-text">x68</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#x64"><span class="toc-text">x64</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E7%AC%A6%E5%8F%B7%E7%9A%84%E7%AB%8B%E5%8D%B3%E6%95%B0"><span class="toc-text">有符号的立即数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-text">数组</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8086%E6%95%B0%E7%BB%84"><span class="toc-text">8086数组</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%80%E8%A6%81%E4%BB%8B%E7%BB%8D"><span class="toc-text">简要介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8C%87%E9%92%88%E6%95%B0%E7%BB%84"><span class="toc-text">指针数组</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%97%B6%E7%9A%84%E6%B3%A8%E6%84%8F"><span class="toc-text">使用时的注意</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#x86%E6%95%B0%E7%BB%84"><span class="toc-text">x86数组</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%80%E8%A6%81%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-text">简要的介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%B0%83%E7%94%A8%E6%95%B0%E7%BB%84"><span class="toc-text">如何调用数组</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%95%B0%E7%BB%84%E9%95%BF%E5%BA%A6"><span class="toc-text">计算数组长度</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E9%92%88"><span class="toc-text">指针</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B1%87%E7%BC%96%E6%8C%87%E9%92%88"><span class="toc-text">汇编指针</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E6%B1%87%E7%BC%96%E5%92%8CC%E6%8C%87%E9%92%88"><span class="toc-text">反汇编和C指针</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-text">结构体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E9%BD%90"><span class="toc-text">对齐</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E4%B8%8E%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">声明与初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="toc-text">如何使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E6%95%B0%E7%BB%84"><span class="toc-text">结构体数组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%85%E5%90%AB%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-text">包含结构体的结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80"><span class="toc-text">内存布局</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E4%BD%93"><span class="toc-text">联合体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8F"><span class="toc-text">宏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8F%E5%A3%B0%E6%98%8E"><span class="toc-text">宏声明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%AE%8F"><span class="toc-text">参数宏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%AE%8F"><span class="toc-text">函数宏</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%89%88"><span class="toc-text">普通版</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%89%88"><span class="toc-text">其他版</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8F%E5%B5%8C%E5%A5%97"><span class="toc-text">宏嵌套</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%AE%8F"><span class="toc-text">条件宏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8F%E8%B0%83%E7%94%A8%E7%9A%84%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">宏调用的默认参数初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">布尔表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IF-x2F-ELSE-x2F-ENDIF"><span class="toc-text">IF&#x2F;ELSE&#x2F;ENDIF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">特殊运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#amp-%E6%9B%BF%E6%8D%A2%E7%AC%A6%E5%8F%B7"><span class="toc-text">&amp; 替换符号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E8%BD%AC%E5%8C%96"><span class="toc-text">% 格式转化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#lt-gt-%E6%96%87%E5%AD%97%E6%96%87%E6%9C%AC%E6%9B%BF%E6%8D%A2%E7%AC%A6"><span class="toc-text">&lt; &gt; 文字文本替换符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%BA%E5%88%B6%E5%A4%84%E7%90%86%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">!  强制处理运算符</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8F%E5%BE%AA%E7%8E%AF"><span class="toc-text">宏循环</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#while"><span class="toc-text">while</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#repeat"><span class="toc-text">repeat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#for-%E5%BE%AA%E7%8E%AF%E5%8F%96%E6%95%B4%E6%95%B0"><span class="toc-text">for 循环取整数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#forc-%E5%BE%AA%E7%8E%AF%E5%8F%96%E5%AD%97%E7%AC%A6"><span class="toc-text">forc 循环取字符</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#REQ"><span class="toc-text">REQ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ECHO"><span class="toc-text">ECHO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#x64%E5%AE%8F"><span class="toc-text">x64宏</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E8%A1%A8"><span class="toc-text">链表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95"><span class="toc-text">第一次尝试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%B0%9D%E8%AF%95"><span class="toc-text">第二次尝试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%8E%E9%A2%91"><span class="toc-text">低频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#real"><span class="toc-text">real</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BCD"><span class="toc-text">BCD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#label-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">label 数据类型</span></a></li></ol></li></ol></div></div></widget>




</div>


    </aside>
    <div class='l_main'>
      

      


<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/re4mile/">主页</a><span class="sep"></span><a class="cap breadcrumb" href="/re4mile/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/re4mile/categories/Language/">Language</a></div><div id="post-meta">发布于&nbsp;<time datetime="2021-06-07T01:00:00.000Z">2021-06-07</time></div></div>

<article class='md-text content post reveal'>
<h1 class="article-title"><span>x86汇编语言基础部分</span></h1>
<h1 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h1><p>段寄存器</p>
<table>
<thead>
<tr>
<th>寄存器</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>CS(code segment)</td>
<td>代码段地址寄存器，存放代码段的起始地址</td>
</tr>
<tr>
<td>DS(data segment)</td>
<td>数据段地址寄存器，存放数据段的起始地址</td>
</tr>
<tr>
<td>SS(stack segment)</td>
<td>堆栈段地址寄存器，存放堆栈段的起始地址</td>
</tr>
<tr>
<td>ES(extra segment)</td>
<td>附加段地址寄存器，存放附加段的起始地址</td>
</tr>
</tbody></table>
<p>控制寄存器</p>
<p>IP(Instruction Pointer):指令指针寄存器，存放代码段中指令的偏移地址。</p>
<p>FR(Flags Register):标志寄存器，用于存放反映处理器和运行程序执行结果状态的控制标志和条件码标志。</p>
<h2 id="x86寄存器"><a href="#x86寄存器" class="headerlink" title="x86寄存器"></a>x86寄存器</h2><p>8个通用寄存器：EAX、EBX、ECX、EDX、ESI、EDI、ESP、EBP</p>
<p>1个标志寄存器：EFLAGS</p>
<p>其他寄存器：EIP、TSC等</p>
<table>
<thead>
<tr>
<th align="center">长度是32位寄存器</th>
<th align="center">长度是16位寄存器</th>
<th align="center">长度是8位寄存器</th>
</tr>
</thead>
<tbody><tr>
<td align="center">EAX</td>
<td align="center">AX</td>
<td align="center">AH、AL</td>
</tr>
<tr>
<td align="center">EBX</td>
<td align="center">BX</td>
<td align="center">BH、BL</td>
</tr>
<tr>
<td align="center">ECX</td>
<td align="center">CX</td>
<td align="center">CH、CL</td>
</tr>
<tr>
<td align="center">EDX</td>
<td align="center">DX</td>
<td align="center">DH、DL</td>
</tr>
<tr>
<td align="center">ESI</td>
<td align="center">SI</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">EDI</td>
<td align="center">DI</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ESP</td>
<td align="center">SP</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">EBP</td>
<td align="center">BP</td>
<td align="center"></td>
</tr>
</tbody></table>
<p>eax 累加器(Accumulator), 它的低16位即是AX，而AX又可分为高8位AH和低8位AL。</p>
<p>ebx 基地址寄存器(Base Register), 它的低16位即是BX，而BX又可分为高8位BH和低8位BL。</p>
<p>ecx 计数寄存器（Count Register），它的低16位即是CX，而CX又可分为高8位CH和低8位CL。</p>
<p>edx 数据寄存器（Data Register），它的低16位即是DX，而DX又可分为高8位DH和低8位DL。</p>
<p>ESI&#x2F;EDI:做源&#x2F;目标索引寄存器(Source&#x2F;Destination Index Register)，它们的低16位分别是SI、DI。</p>
<p>EBP&#x2F;BSP 基址针寄存器（Base Pointer Register）&#x2F;堆栈指针寄存器（Stack Pointer Register），</p>
<p>​		低16位是BP、SP，其内存分别放着一个指针，该指针永远指向系统栈最上面一个栈帧的栈顶&#x2F;底部</p>
<p>eax 函数的返回值,</p>
<p>ebx 主要用于在内存寻址时存放基地址</p>
<p>ecx 在循环和字符串操作时，要用它来控制循环次数；</p>
<p>​	在位操作 中，当移多位时，要用CL来指明移位的位数；</p>
<p>​	是重复(REP)前缀指令和LOOP指令的内定计数器</p>
<p>edx 在进行乘、除运算时，它可作为默认的操作数参与运算，</p>
<p>​	也可用于存放I&#x2F;O的端口地址；</p>
<p>​	且总是被用来放整数除法产生的余数。</p>
<p>esi&#x2F;edi 它们主要用于存放存储单元在段内的偏移量，用它们可实现多种存储器操作数的寻址方式，</p>
<p>​		在很多字符串操作指令中, DS:ESI指向源串,而ES:EDI指向目标串。</p>
<p>​		此外，它们又作为通用寄存器可以进行任意的常规的操作，如加减移位或普通的内存间接寻址。</p>
<p>esp&#x2F;ebp: 主要用于存放堆栈内存储单元的偏移量，用它们可实现多种存储器操作数的寻址方式</p>
<p>​		指针寄存器不可分割成8位寄存器。作为通用寄存器，也可存储算术逻辑运算的操作数和运算结果。</p>
<p>​		并且规定：BP为基指针(Base 	Pointer)寄存器用它可直接存取堆栈中的数据；SP为堆栈指针(Stack Pointer)寄存器，</p>
<p>​		用它只可访问栈顶。在32位平台上，ESP每次减少4字节</p>
<h2 id="x64寄存器"><a href="#x64寄存器" class="headerlink" title="x64寄存器"></a>x64寄存器</h2><p>x64 结构提供了 16 个通用寄存器（以后称为整数寄存器），</p>
<p>16 个 XMM 寄存器 (注意xmm寄存器是128位,而不是64位)</p>
<p>xmm寄存器主要用于浮点数处理</p>
<p>ymm寄存器 256位</p>
<table>
<thead>
<tr>
<th>寄存器名</th>
<th>寄存器简介</th>
<th>主要功能</th>
<th align="center">64bit</th>
<th>32bit</th>
<th>16bit</th>
<th>8bit</th>
</tr>
</thead>
<tbody><tr>
<td>rax</td>
<td>累加器，是算术运算的主要寄存器</td>
<td>存储返回值</td>
<td align="center">rax</td>
<td>eax</td>
<td>ax</td>
<td>al</td>
</tr>
<tr>
<td>rbx</td>
<td>基址寄存器，被调用者保存</td>
<td>存放存储区的起始地址</td>
<td align="center">rbx</td>
<td>ebx</td>
<td>bx</td>
<td>bl</td>
</tr>
<tr>
<td>rcx</td>
<td>计数寄存器</td>
<td>循环操作和字串处理的计数控制；函数调用时的第4个参数</td>
<td align="center">rcx</td>
<td>ecx</td>
<td>cx</td>
<td>cl</td>
</tr>
<tr>
<td>rdx</td>
<td>I&#x2F;O指针</td>
<td>I&#x2F;O操作时提供外部设备接口的端口地址；函数调用时的第3个参数</td>
<td align="center">rdx</td>
<td>edx</td>
<td>dx</td>
<td>dl</td>
</tr>
<tr>
<td>rsi</td>
<td>(source index)源变址寄存器，与rds段寄存器联用，可以访问数据段中的任一个存储单元</td>
<td>函数调用时的第2个参数</td>
<td align="center">rsi</td>
<td>esi</td>
<td>si</td>
<td>sil</td>
</tr>
<tr>
<td>rdi</td>
<td>(destination index)目的变址寄存器，与res段寄存器联用，可以访问附加段中的任一个存储单元</td>
<td>函数调用时的第1个参数</td>
<td align="center">rdi</td>
<td>edi</td>
<td>di</td>
<td>dil</td>
</tr>
<tr>
<td>rbp</td>
<td>(base pointer)基址指针寄存器，用于提供堆栈内某个单元的偏移地址，与rss段寄存器联用，可以访问堆栈中的任一个存储单元，被调用者保存</td>
<td></td>
<td align="center">rbp</td>
<td>ebp</td>
<td>bp</td>
<td>bpl</td>
</tr>
<tr>
<td>rsp</td>
<td>(stack pointer)栈顶指针寄存器，提供堆栈栈顶单元的偏移地址，与rss段寄存器联用，以控制数据进栈和出栈</td>
<td></td>
<td align="center">rsp</td>
<td>esp</td>
<td>sp</td>
<td>spl</td>
</tr>
<tr>
<td>r8</td>
<td></td>
<td>函数调用时的第5个参数</td>
<td align="center">r8</td>
<td>r8d</td>
<td>r8w</td>
<td>r8b</td>
</tr>
<tr>
<td>r9</td>
<td></td>
<td>函数调用时的第6个参数</td>
<td align="center">r9</td>
<td>r9d</td>
<td>r9w</td>
<td>r9b</td>
</tr>
<tr>
<td>r10</td>
<td>调用者保存</td>
<td></td>
<td align="center">r10</td>
<td>r10d</td>
<td>r10w</td>
<td>r10b</td>
</tr>
<tr>
<td>r11</td>
<td>调用者保存</td>
<td></td>
<td align="center">r11</td>
<td>r11d</td>
<td>r11w</td>
<td>r11b</td>
</tr>
<tr>
<td>r12</td>
<td>被调用者保存</td>
<td></td>
<td align="center">r12</td>
<td>r12d</td>
<td>r12w</td>
<td>r12b</td>
</tr>
<tr>
<td>r13</td>
<td>被调用者保存</td>
<td></td>
<td align="center">r13</td>
<td>r13d</td>
<td>r13w</td>
<td>r13b</td>
</tr>
<tr>
<td>r14</td>
<td>被调用者保存</td>
<td></td>
<td align="center">r14</td>
<td>r14d</td>
<td>r14w</td>
<td>r14b</td>
</tr>
<tr>
<td>r15</td>
<td>被调用者保存</td>
<td></td>
<td align="center">r15</td>
<td>r15d</td>
<td>r15w</td>
<td>r15b</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movsd   xmm0, qword ptr [rsi]</span><br><span class="line">movsd   xmm1, qword ptr [rsi+8]</span><br></pre></td></tr></table></figure>

<p>奇怪啊,奇怪</p>
<h2 id="x64寄存器调用约定"><a href="#x64寄存器调用约定" class="headerlink" title="x64寄存器调用约定"></a>x64寄存器调用约定</h2><p>对于一般的函数传参,实际情况在调试的时候可以确定</p>
<table>
<thead>
<tr>
<th>参数位置</th>
<th>寄存器名字</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>参数1</td>
<td>rcx</td>
<td></td>
</tr>
<tr>
<td>参数2</td>
<td>rdx</td>
<td></td>
</tr>
<tr>
<td>参数3</td>
<td>r8</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="标志寄存器"><a href="#标志寄存器" class="headerlink" title="标志寄存器"></a>标志寄存器</h2><p>CF:  进位标志符号比     排在第0位<br>PF:  奇偶标志      排在第2位<br>AF:  辅助进位标志     排在第4位<br>ZF:  零标志       排在第6位<br>SF:  符号标志      排在第7位<br>TF:  追踪标志       排在第8位<br>IF:  中断允许标志      排在第9位<br>DF:  方向标志       排在第10位<br>OF:  溢出标志       排在第11位</p>
<p> <img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://resmile.gitee.io/blog/Asm-%E5%9F%BA%E7%A1%80/image-20221025005410035.png" alt="image-20221025005410035"></p>
<p>对于上面的位置,我们不需要去记住</p>
<p> <img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://resmile.gitee.io/blog/Asm-%E5%9F%BA%E7%A1%80/image-20221025005425740.png" alt="image-20221025005425740"></p>
<h3 id="CF-无符号溢出"><a href="#CF-无符号溢出" class="headerlink" title="CF 无符号溢出"></a>CF 无符号溢出</h3><p>无符号数溢出,无符号数进位</p>
<p>CF 把所有的数据都当作无符号的数来处理</p>
<p>Carry : 进位的意思</p>
<p>1:CY carry yes</p>
<p>0:NC not carry</p>
<p>1-2,发生了借位,CF&#x3D;&#x3D;1</p>
<p>1+9,发生了进位,CF&#x3D;1</p>
<p>进位后的数据被丢到了CF中</p>
<p>STC 让CF&#x3D;1</p>
<p>CLC 让CF&#x3D;0</p>
<p>CMC 让CF取反</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mov al,<span class="number">0x7f</span></span><br><span class="line">add al,<span class="number">1</span></span><br><span class="line">不会引起CF改变</span><br><span class="line">inc al,更不会</span><br><span class="line"></span><br><span class="line">mvo al,<span class="number">0xff</span></span><br><span class="line">inc al 不会</span><br><span class="line">dec al</span><br><span class="line">add al,<span class="number">1</span>会引起改变</span><br></pre></td></tr></table></figure>



<p>dec&#x2F;inc不会影响CF</p>
<p>add&#x2F;adc指令对标志位的影响：</p>
<p>​	CF&#x3D;1  最高有效位向高位有进位</p>
<p>​	CF&#x3D;0  最高有效位向高位无进位</p>
<p>sub&#x2F;sbb&#x2F;cmp 指令对标志位的影响：</p>
<p>​     CF&#x3D;1 二进制减法运算中最高有效位向高位有借位（被减数小于减数，不够减的情况）</p>
<p>​     CF&#x3D;0 二进制减法运算中最高有效为向高位无借位（被减数〉&#x3D;减数，够减的情况）</p>
<p>neg</p>
<p>​	CF&#x3D;1 不为0的操作数求补时</p>
<p>​	CF&#x3D;0 为0的操作数求补时</p>
<h3 id="PF"><a href="#PF" class="headerlink" title="PF"></a>PF</h3><p>与奇偶性有关</p>
<p>parity:奇数与偶数,奇偶性</p>
<p>Evem : 偶数</p>
<p>Odd : 奇数</p>
<p>最低有效的8位有多少个1,而不是看所有的位</p>
<p>1: PE Parity_Evem,二进制中有偶数个1</p>
<p>0: PO parity_Odd ,二进制中有奇数个1</p>
<p>这是代表了一个二进制位数上的奇偶性质,数值本身的奇偶与这个标志位无关</p>
<blockquote>
<p>add&#x2F;adc&#x2F;inc&#x2F;sub&#x2F;sbb&#x2F;dec&#x2F;cmp</p>
</blockquote>
<h3 id="AF"><a href="#AF" class="headerlink" title="AF"></a>AF</h3><p>辅助进位标志AF(Auxiliary Carry Flag)：</p>
<p> 在发生下列情况时，辅助进位标志AF的值被置为1，否则其值为0：</p>
<p>(1)  在 双字（dword）操作时，如eax,发生低字eal,向高字eah进位或借位时；</p>
<p>(2)、在字（word）操作时，如ax,发生al低字节向高字节ah进位或借位时；</p>
<p>(3)、在字节（byte）操作时如al，发生低4位向高4位进位或借位时</p>
<p>其规律就是数据宽度的一半向另外一半进位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MOV EAX,0X555EFFFF　　　　</span><br><span class="line">MOV AX,0X5EFF　　　　</span><br><span class="line">MOV AL,0X5F</span><br><span class="line">ADD EAX,0X2　　　　　　　　  </span><br><span class="line">MOV AX,0X2　　　　　   </span><br><span class="line">MOV AL,0X2</span><br></pre></td></tr></table></figure>



<blockquote>
<p>add&#x2F;adc&#x2F;inc&#x2F;sub&#x2F;sbb&#x2F;dec&#x2F;cmp</p>
</blockquote>
<h3 id="ZF"><a href="#ZF" class="headerlink" title="ZF:"></a>ZF:</h3><p> Zero_Flag</p>
<p>与计算结果为0相关</p>
<p>1: ZR Zero</p>
<p>0: NZ not zero</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xor eax,eax</span><br></pre></td></tr></table></figure>



<blockquote>
<p>add&#x2F;adc&#x2F;inc&#x2F;sub&#x2F;sbb&#x2F;dec&#x2F;cmp</p>
</blockquote>
<h3 id="SF"><a href="#SF" class="headerlink" title="SF:"></a>SF:</h3><p> Sign_Flag</p>
<p>Sign : 符号,正负</p>
<p>Negativbe:,负数</p>
<p>Positive ;正数</p>
<p>符号标志SF用来反映运算结果的符号位，它与运算结果的最高位相同。</p>
<p>1 : NG Negativbe_Large,负数</p>
<p>0 : PL Positive_Little ,正数</p>
<p>如果运算产生负数,SF&#x3D;1</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov ah,<span class="number">0x7F</span></span><br><span class="line">add ah,<span class="number">1</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>add&#x2F;adc&#x2F;inc&#x2F;sub&#x2F;sbb&#x2F;dec&#x2F;cmp</p>
</blockquote>
<h3 id="TF"><a href="#TF" class="headerlink" title="TF:"></a>TF:</h3><p>追踪标志位trap flag</p>
<p>当TF&#x3D;1,cpu进入单步执行状态</p>
<p>每执行一条语句,产生一个中断请求</p>
<p>感觉可以在这里做一点文章…</p>
<p>该寄存器可以用于程序的调试</p>
<h3 id="IF"><a href="#IF" class="headerlink" title="IF:"></a>IF:</h3><p>interrupt enable flag</p>
<p>中断允许标志</p>
<p>中断允许标志用来决定cpu是否响应CPU外部可屏蔽中断发生的请求</p>
<p>对于不可以屏蔽的中断还有cpu内部发生的中断,他就没有办法了,必须响应</p>
<p>IF&#x3D;1,响应外部可屏蔽中断</p>
<p>IF&#x3D;0,不响应可屏蔽中断</p>
<p>STI 让IF&#x3D;1</p>
<p>CLI 让IF&#x3D;0</p>
<h3 id="DF"><a href="#DF" class="headerlink" title="DF"></a>DF</h3><p>direction_flag</p>
<p>方向位标志寄存器</p>
<p>指令std,cld可以修改它</p>
<p>STD 让DF&#x3D;1 表示-</p>
<p>CLD 让DF&#x3D;0 表示+</p>
<p>与movsb,movsw,movsd有关</p>
<p>串传送指令</p>
<h3 id="OF-有符号溢出"><a href="#OF-有符号溢出" class="headerlink" title="OF 有符号溢出"></a>OF 有符号溢出</h3><p>学习CF与OF，要始终牢记一点。</p>
<p>CF是无符号数溢出标志，</p>
<p>OF是有符号数溢出标志。</p>
<p>一个无符号的byte,超过了255就是CF&#x3D;1</p>
<p>一个有符号的byte,超过了127,就是OF&#x3D;1</p>
<p>OF : Over_Flow</p>
<p>1  : OV over_flow</p>
<p>0  : NV not_over_flag</p>
<p>OF把数据看作有符号来处理</p>
<p>超过max,小于min,就会OF&#x3D;1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xor     eax, eax</span><br><span class="line">mov     al, 7Fh;127		上溢</span><br><span class="line">add     al, 1</span><br><span class="line">xor     eax, eax</span><br><span class="line">mov     al, 80h ; -128	下溢</span><br><span class="line">sub     al, 1</span><br></pre></td></tr></table></figure>



<p>规律2个数相加</p>
<p> <img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://resmile.gitee.io/blog/Asm-%E5%9F%BA%E7%A1%80/image-20221025005444436.png" alt="image-20221025005444436"></p>
<p>只有0x7F到0x80,才叫OF溢出</p>
<p>根据10进制本质的符号运算</p>
<p>正数+正数&#x3D;…</p>
<p>负数+负数&#x3D;…</p>
<p>正数[0,1&#x2F;2]</p>
<p>负数(1&#x2F;2,1)</p>
<p>那么正数+负数</p>
<p>(1&#x2F;2,3&#x2F;2) 那么是不会经过0x7F-&gt;0x80的</p>
<p>于是正数+负数是不会溢出的</p>
<blockquote>
<p>CPU是如何让OF发生改变的</p>
<p>1000 0000</p>
<p>+1100 0000</p>
<hr>
<p>8bit位,右边0开始计数</p>
<p>如果[7]发生了进位,那么ret&#x3D;1</p>
<p>如果[6]发生了进位,那么ret2&#x3D;0</p>
<p>如果ret1^ret2&#x3D;1,那么OF&#x3D;1</p>
<p>也就是ret1和ret2中只有一个位1的时候,OF&#x3D;1</p>
</blockquote>
<p>add </p>
<p>​	OF&#x3D;1  两个同符号数相加（正数+正数 或 负数+负数），结果符号与其相反。</p>
<p>​	OF&#x3D;0  两个不同符号数相加，或同符号数相加，结果符号与其相同。</p>
<p>adc&#x2F;inc </p>
<p>​    OF&#x3D;1  两个同符号数相加，结果符号与其相反，</p>
<p>​    OF&#x3D;0  两个同符号数相加，或同符号相加，结果符号与其相同</p>
<p>sub&#x2F;dec</p>
<p>​	OF&#x3D;1 两数符号相反（正数-负数，或负数-正数），而结果符号与减数相同。</p>
<p>​	OF&#x3D;0 同符号数相减时，或不同符号数相减，其结果符号与减数不同。</p>
<p>neg</p>
<p>​	OF&#x3D;1  操作数为-128（字节运算）或操作数为-32768（字运算）</p>
<p>​    OF&#x3D;0  当求补运算的操作数不为－128（字节）或－32768（字）时</p>
<h3 id="IOPF"><a href="#IOPF" class="headerlink" title="IOPF :"></a>IOPF :</h3><p>I&#x2F;O 特权标志</p>
<p>它可表示当前运行程序或者任务访问1&#x2F;0指令的特权级</p>
<p>若当前运行程序或者任务的特权级别cpl&lt;&#x3D;IPOL(00B)的时候,则可以执行I&#x2F;O指令,否则会发生异常</p>
<p>这里可以做文章</p>
<p>该值只能被允许与CPL&#x3D;0的程序或任务通过popf&#x2F;popfd指令或者iret指令进行修改</p>
<p>因此,一般用户程序(CPL&#x3D;3)是无法执行I&#x2F;O指令的</p>
<h3 id="NT"><a href="#NT" class="headerlink" title="NT"></a>NT</h3><p>nested task flag</p>
<p>NT&#x3D;1,表示当前任务嵌套于前一任务</p>
<p>否则当前任务不嵌套于任何任务</p>
<p>当执行call指令&#x2F;中断&#x2F;异常时,cpu让NT&#x3D;1</p>
<p>当任务执行返回时,通过iret让NT&#x3D;0</p>
<p>问题来了…调用一个call就让NT&#x3D;1,就这么随便吗?</p>
<p>另外NT&#x3D;0只能是iret吗?</p>
<h3 id="RF"><a href="#RF" class="headerlink" title="RF"></a>RF</h3><p>恢复标志位 resume flag</p>
<p>恢复标志位用于控制cpu是否接受指令断点的调试异常</p>
<p>若RF&#x3D;0,表示接受调试异常,否则不接受</p>
<p>该标志位一般友调试器设置,可以在刚进入调试异常的时暂时关闭新调试异常,</p>
<p>以避免调试异常时又立即进入了另外一个调试异常</p>
<h3 id="VM"><a href="#VM" class="headerlink" title="VM :"></a>VM :</h3><p>virtual-8086 mode flag</p>
<p>虚拟8086模式标志</p>
<p>若VM&#x3D;1,表示cpu进入了虚拟8086模式</p>
<p>否则进入了保护模式</p>
<h3 id="AC"><a href="#AC" class="headerlink" title="AC :"></a>AC :</h3><p>Algnment check flag</p>
<p>对齐检查标志位</p>
<p>若AC&#x3D;1, 且控制寄存器的cr0的AM标志位也为1,则允许内存地址进行对齐的检测</p>
<p>否则不允许</p>
<p>当程序的特权级别为3且运行于用户模式,若地址不对齐(即字访问时地址为奇数,双字访问时,地址不能被4整除),将产生对齐检查异常</p>
<p>之前我们只是提及过,寻址偶数地址会更加的快,国更加的发挥CPU的性能</p>
<p>CPU对非对齐字节地址访问内存,时间可能更加的长,若要求必须对齐,这要进行对齐检查</p>
<h3 id="VIF"><a href="#VIF" class="headerlink" title="VIF :"></a>VIF :</h3><p>virtual interrupt  flag</p>
<p>虚拟中断标志寄存器VIF为IF标志的虚拟印象,</p>
<p>问题来了</p>
<p>什么叫虚拟印象</p>
<p>这个标志位与VIP标志配合使用,允许多任务环境下应用程序有虚拟的系统IF标志</p>
<h3 id="VIP"><a href="#VIP" class="headerlink" title="VIP:"></a>VIP:</h3><p>virtual interrupt pending flag</p>
<p>虚拟中断挂起标志</p>
<p>若vip&#x3D;1,表示有挂起的中断</p>
<p>否则没有挂起的中断</p>
<p>一般由软件对其标志位初始化或者复位</p>
<p>CPU仅仅是读取,他与VIF配合使用</p>
<h3 id="ID"><a href="#ID" class="headerlink" title="ID :"></a>ID :</h3><p>identification flag</p>
<p>识别标志位</p>
<p>若ID位能被置位或者复位,则说明CPU支持CPUID指令</p>
<p>CPUID可以提供CPU的厂商,系列号等信息</p>
<h2 id="特殊的指令和flag"><a href="#特殊的指令和flag" class="headerlink" title="特殊的指令和flag"></a>特殊的指令和flag</h2><h3 id="MUL-x2F-IMUL"><a href="#MUL-x2F-IMUL" class="headerlink" title="MUL&#x2F;IMUL"></a>MUL&#x2F;IMUL</h3><p>MUL指令的条件码设置为：</p>
<p>CF OF&#x3D;0 0 乘积的高一半为0（字节操作的（AH）或字操作的（DX））</p>
<p>CF OF&#x3D;1 1 乘积的高一半不为0</p>
<p>​           </p>
<p>IMUL指令的条件码设置为：</p>
<p>CF OF&#x3D;0 0 乘积的高一半为低一半的符号扩展.</p>
<p>CF OF&#x3D;1 1 其他情况</p>
<h3 id="and"><a href="#and" class="headerlink" title="and"></a>and</h3><p>指令对标志位的影响：</p>
<p>​           指令执行后 CF 和 OF 置零，AF无定义。</p>
<p>​           PF&#x3D;1 结果操作数中1的个数为偶数时置1</p>
<p>​           PF&#x3D;0 结果操作数中1的个数为奇数时置0 </p>
<h3 id="or"><a href="#or" class="headerlink" title="or"></a>or</h3><p>指令对标志位的影响：</p>
<p>令执行后 CF 和 OF 置零，AF无定义。</p>
<p>PF&#x3D;1 结果操作数中1的个数为偶数时置1</p>
<p>PF&#x3D;0 结果操作数中1的个数为奇数时置0</p>
<h3 id="xor"><a href="#xor" class="headerlink" title="xor"></a>xor</h3><p>指令对标志位的影响：</p>
<p>执行后 CF 和 OF 置零，AF无定义。</p>
<p>PF&#x3D;1 结果操作数中1的个数为偶数时置1</p>
<p>PF&#x3D;0 结果操作数中1的个数为奇数时置0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xor eax,eax zf=0</span><br></pre></td></tr></table></figure>

<h3 id="test"><a href="#test" class="headerlink" title="test"></a>test</h3><p>指令对标志位的影响：</p>
<p>令执行后 CF 和 OF 置零，AF无定义。</p>
<p>PF&#x3D;1 结果操作数中1的个数为偶数时置1</p>
<p>PF&#x3D;0 结果操作数中1的个数为奇数时置0</p>
<h3 id="逻辑左移-SHL"><a href="#逻辑左移-SHL" class="headerlink" title="逻辑左移 SHL"></a>逻辑左移 SHL</h3><p>指令对标志位的影响： CF&#x3D;移入的数值</p>
<p>OF&#x3D;1 当count&#x3D;1时，移动后最高位的值发生变化。</p>
<p>OF&#x3D;0 当count&#x3D;1时，移动时最高位的值未发生变化。</p>
<h3 id="逻辑右移-SHR"><a href="#逻辑右移-SHR" class="headerlink" title="逻辑右移 SHR"></a>逻辑右移 SHR</h3><p>指令对标志位的影响：CF&#x3D;移入的数值</p>
<p>OF&#x3D;1 当count&#x3D;1时，移动后最高位的值发生变化。</p>
<p>OF&#x3D;0 当count&#x3D;1时，移动时最高位的值未发生变化。</p>
<h3 id="算术左移-SAL"><a href="#算术左移-SAL" class="headerlink" title="算术左移 SAL"></a>算术左移 SAL</h3><p>指令对标志位的影响：CF&#x3D;移入的数值</p>
<p>OF&#x3D;1 当count&#x3D;1时，移动后最高位的值发生变化。</p>
<p>OF&#x3D;0 当count&#x3D;1时，移动时最高位的值未发生变化。</p>
<h3 id="算术右移SAR"><a href="#算术右移SAR" class="headerlink" title="算术右移SAR"></a>算术右移SAR</h3><p>指令对标志位的影响：CF&#x3D;移入的数值</p>
<p>OF&#x3D;1 当count&#x3D;1时，移动后最高位的值发生变化。</p>
<p>OF&#x3D;0 当count&#x3D;1时，移动时最高位的值未发生变化。</p>
<h3 id="循环左移-ROL"><a href="#循环左移-ROL" class="headerlink" title="循环左移 ROL"></a>循环左移 ROL</h3><p>指令对标志位的影响：CF&#x3D;移入的数值</p>
<p>OF&#x3D;1 当count&#x3D;1时，移动后最高位的值发生变化。</p>
<p>OF&#x3D;0 当count&#x3D;1时，移动时最高位的值未发生变化。</p>
<h3 id="循环右移-ROR"><a href="#循环右移-ROR" class="headerlink" title="循环右移 ROR"></a>循环右移 ROR</h3><p>指令对标志位的影响：CF&#x3D;移入的数值</p>
<p>OF&#x3D;1 当count&#x3D;1时，移动后最高位的值发生变化。</p>
<p>OF&#x3D;0 当count&#x3D;1时，移动时最高位的值未发生变化。</p>
<h3 id="带进位的循环左移-RCL"><a href="#带进位的循环左移-RCL" class="headerlink" title="带进位的循环左移 RCL"></a>带进位的循环左移 RCL</h3><p>指令对标志位的影响：CF&#x3D;移入的数值。</p>
<p>OF&#x3D;1 当cnt&#x3D;1时，移动后最高位的值未发生变化。</p>
<p>OF&#x3D;0 当cnt&#x3D;1时，移动后最高位的值发生变化。</p>
<p>SF、ZF、PF标志位不受影响。</p>
<h3 id="带进位的循环右移-RCR"><a href="#带进位的循环右移-RCR" class="headerlink" title="带进位的循环右移 RCR"></a>带进位的循环右移 RCR</h3><p>指令对标志位的影响：CF&#x3D;移入的数值。</p>
<p> OF&#x3D;1 当cnt&#x3D;1时，操作数最高位的值未发生变化。</p>
<p> OF&#x3D;0 当cnt&#x3D;1时，操作数最高位的值发生变化。</p>
<p> SF、ZF、PF标志位不受影响。</p>
<h3 id="串比较-CMPSB-x2F-CMPSW"><a href="#串比较-CMPSB-x2F-CMPSW" class="headerlink" title="串比较 CMPSB &#x2F; CMPSW"></a>串比较 CMPSB &#x2F; CMPSW</h3><p>(compare string byte&#x2F;word)</p>
<p>指令对条件码的影响：</p>
<p>​           CF&#x3D;1 二进制减法运算中最高有效位向高位有借位（被减数小于减数，不够减的情况）</p>
<p>​           CF&#x3D;0 二进制减法运算中最高有效为向高位无借位（被减数〉&#x3D;减数，够减的情况）</p>
<p>​           OF&#x3D;1 两数符号相反（正数-负数，或负数-正数），而结果符号与减数相同。</p>
<p>​           OF&#x3D;0 同符号数相减时，或不同符号数相减，其结果符号与减数不同。</p>
<h3 id="串扫描-SCASB-x2F-SCASW"><a href="#串扫描-SCASB-x2F-SCASW" class="headerlink" title="串扫描 SCASB &#x2F; SCASW"></a>串扫描 SCASB &#x2F; SCASW</h3><p>(scan string byte &#x2F; word)</p>
<p>指令对条件码的影响：</p>
<p>​           CF&#x3D;1 二进制减法运算中最高有效位向高位有借位（被减数小于减数，不够减的情况）</p>
<p>​           CF&#x3D;0 二进制减法运算中最高有效为向高位无借位（被减数〉&#x3D;减数，够减的情况）</p>
<p>​           OF&#x3D;1 两数符号相反（正数-负数，或负数-正数），而结果符号与减数相同。</p>
<p>​           OF&#x3D;0 同符号数相减时，或不同符号数相减，其结果符号与减数不同。</p>
<h3 id="不影响"><a href="#不影响" class="headerlink" title="不影响"></a>不影响</h3><p>串传送MOVSB &#x2F; MOVSW </p>
<p>指令对条件码的影响：不影响条件码。</p>
<p>存串 STOSB &#x2F; STOSW</p>
<p>指令对条件码的影响：不影响条件码。</p>
<p>取串LODSB &#x2F; LODSW </p>
<p>(load from string byte&#x2F;word)</p>
<p>指令对条件码的影响：不影响条件码。</p>
<p>not</p>
<p>指令对标志位的影响：对标志位无影响</p>
<h2 id="与标志寄存器有关的指令"><a href="#与标志寄存器有关的指令" class="headerlink" title="与标志寄存器有关的指令"></a>与标志寄存器有关的指令</h2><h3 id="LAHF"><a href="#LAHF" class="headerlink" title="LAHF"></a>LAHF</h3><p>8086也有指令lahf&#x2F;sahf</p>
<p>L的意思可能就是Load</p>
<p>lahf是把所有的标志寄存器的低8位复制到ah</p>
<p>sahf把ah的数据还给标志寄存器</p>
<h3 id="SAHF"><a href="#SAHF" class="headerlink" title="SAHF"></a>SAHF</h3><p>把AH的数据给flag的低8位</p>
<h3 id="pushf-x2F-pushfd"><a href="#pushf-x2F-pushfd" class="headerlink" title="pushf&#x2F;pushfd"></a>pushf&#x2F;pushfd</h3><p>把16&#x2F;32位的寄存器数据压如栈</p>
<h3 id="popf-x2F-popfd"><a href="#popf-x2F-popfd" class="headerlink" title="popf&#x2F;popfd"></a>popf&#x2F;popfd</h3><p>把栈的值压入16&#x2F;32位的标志寄存器flag</p>
<p>pushad是把通用寄存器入栈</p>
<p>pushfd是吧标志寄存器入栈</p>
<h1 id="mxcsr寄存器"><a href="#mxcsr寄存器" class="headerlink" title="mxcsr寄存器"></a>mxcsr寄存器</h1><table>
<thead>
<tr>
<th align="center">15</th>
<th align="center">14</th>
<th>13</th>
<th>12</th>
<th>11</th>
<th>10</th>
<th>9</th>
<th>8</th>
<th>7</th>
<th>|</th>
<th>6</th>
<th>5</th>
<th>4</th>
<th>3</th>
<th>2</th>
<th>1</th>
<th>0</th>
</tr>
</thead>
<tbody><tr>
<td align="center">FZ</td>
<td align="center">RC</td>
<td>RC</td>
<td>PM</td>
<td>UM</td>
<td>OM</td>
<td>ZM</td>
<td>DM</td>
<td>IM</td>
<td>|</td>
<td>DAZ</td>
<td>PE</td>
<td>UE</td>
<td>OE</td>
<td>ZE</td>
<td>DE</td>
<td>IE</td>
</tr>
<tr>
<td align="center">下溢这0</td>
<td align="center">舍入控制</td>
<td>舍入控制</td>
<td>精度掩码</td>
<td>下溢掩码</td>
<td>溢出掩码</td>
<td>除0错误掩码</td>
<td>非规格化操作掩码</td>
<td>无效操作掩码</td>
<td>|</td>
<td>非规格化操作</td>
<td>精度错误</td>
<td>下溢错误</td>
<td>溢出错误</td>
<td>除0错误</td>
<td>非规格化操作</td>
<td>无效操作错误</td>
</tr>
</tbody></table>
<p>0-6位,也就是最后7位是异常发生的情况,发了就自动的置为1,没有发生就置位0</p>
<p>7-12位是对最后7位的一个异常屏蔽一一对应,</p>
<p>异常屏蔽置为了1,那么发生了异常也不会崩溃</p>
<p>异常屏蔽置为了0,那发生了异常就会崩溃</p>
<p>把DIY的mxcsr值放入寄存器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldmxcsr ds:mxcsr_before </span><br></pre></td></tr></table></figure>

<p>把原有的mxcsr值放入一个内存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stmxcsr ds:mxcsr_after</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">默认情况,没有异常</span><br><span class="line"><span class="number">10.0</span> / <span class="number">2.0</span> = <span class="number">5.0000000000000000</span>, in hex: <span class="number">0x4014000000000000</span></span><br><span class="line">mxcsr before:	 <span class="number">0001</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0000</span></span><br><span class="line">mxcsr after:	 <span class="number">0001</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0000</span></span><br><span class="line"></span><br><span class="line">精度异常</span><br><span class="line"><span class="number">10.0</span> / <span class="number">3.0</span> = <span class="number">3.3333333333333335</span>, in hex: <span class="number">0</span>x <span class="number">40</span> <span class="number">0</span>a aa aa aa aa aa ab</span><br><span class="line">mxcsr before:	 <span class="number">0001</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0000</span></span><br><span class="line">mxcsr after:	 <span class="number">0001</span> <span class="number">1111</span> <span class="number">1010</span> <span class="number">0000</span></span><br><span class="line"></span><br><span class="line">除<span class="number">0</span>异常</span><br><span class="line"><span class="number">10.0</span> / <span class="number">0.0</span> = inf, in hex: <span class="number">0x7ff0000000000000</span></span><br><span class="line">mxcsr before:	 <span class="number">0001</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0000</span></span><br><span class="line">mxcsr after:	 <span class="number">0001</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0100</span></span><br><span class="line"></span><br><span class="line">向上取整:</span><br><span class="line"><span class="number">10.0</span>  / <span class="number">3.0</span> = <span class="number">3.3333333333333335</span>, in hex: <span class="number">0x400aaaaaaaaaaaab</span></span><br><span class="line">mxcsr before:	 <span class="number">0101</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0000</span></span><br><span class="line">mxcsr after:	 <span class="number">0101</span> <span class="number">1111</span> <span class="number">1010</span> <span class="number">0000</span></span><br><span class="line"></span><br><span class="line">向下取整:</span><br><span class="line"><span class="number">10.0</span> / <span class="number">3.0</span> = <span class="number">3.3333333333333330</span>, in hex: <span class="number">0x400aaaaaaaaaaaaa</span></span><br><span class="line">mxcsr before:	 <span class="number">0011</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0000</span></span><br><span class="line">mxcsr after:	 <span class="number">0011</span> <span class="number">1111</span> <span class="number">1010</span> <span class="number">0000</span></span><br><span class="line"></span><br><span class="line">截断:</span><br><span class="line"><span class="number">10.0</span> / <span class="number">3.0</span> = <span class="number">3.3333333333333330</span>, in hex: <span class="number">0x400aaaaaaaaaaaaa</span></span><br><span class="line">mxcsr before:	 <span class="number">0111</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0000</span></span><br><span class="line">mxcsr after:	 <span class="number">0111</span> <span class="number">1111</span> <span class="number">1010</span> <span class="number">0000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">精度异常:</span><br><span class="line"><span class="number">11.0</span> /  <span class="number">3.0</span> = <span class="number">3.6666666666666665</span>, in hex: <span class="number">0x400d555555555555</span></span><br><span class="line">mxcsr before:	 <span class="number">0001</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0000</span></span><br><span class="line">mxcsr after:	 <span class="number">0001</span> <span class="number">1111</span> <span class="number">1010</span> <span class="number">0000</span></span><br><span class="line"></span><br><span class="line">向上取整::</span><br><span class="line"><span class="number">11.0</span> / y <span class="number">3.0</span> = <span class="number">3.6666666666666670</span>, in hex: <span class="number">0x400d555555555556</span></span><br><span class="line">mxcsr before:	 <span class="number">0101</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0000</span></span><br><span class="line">mxcsr after:	 <span class="number">0101</span> <span class="number">1111</span> <span class="number">1010</span> <span class="number">0000</span></span><br><span class="line"></span><br><span class="line">向下取整:</span><br><span class="line"><span class="number">11.0</span> / <span class="number">3.0</span> = <span class="number">3.6666666666666665</span>, in hex: <span class="number">0x400d555555555555</span></span><br><span class="line">mxcsr before:	 <span class="number">0011</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0000</span></span><br><span class="line">mxcsr after:	 <span class="number">0011</span> <span class="number">1111</span> <span class="number">1010</span> <span class="number">0000</span></span><br><span class="line"></span><br><span class="line">截断:</span><br><span class="line"><span class="number">11.0</span> /<span class="number">3.0</span> = <span class="number">3.6666666666666665</span>, in hex: <span class="number">0x400d555555555555</span></span><br><span class="line">mxcsr before:	 <span class="number">0111</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0000</span></span><br><span class="line">mxcsr after:	 <span class="number">0111</span> <span class="number">1111</span> <span class="number">1010</span> <span class="number">0000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>这些异常处理我们针对不同的情况作了一些掩码</p>
<p>然后异常发生后,因为屏蔽作了掩码,就不会发生了异常</p>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><p>1、存储数据的宽度		杯子有多大</p>
<p>2、存储数据的格式		杯子能装什么</p>
<p>3、作用范围(作用域)	 杯子可以在哪里用</p>
<p>关于变量声明</p>
<p>变量名 数据类型 数据值</p>
<p>而我们的变量名是可以缺少的,因为他的地址就可以引用它</p>
<p>没有变量名的地址就像一个没有名字的指针,我们很难引用它</p>
<p>在x86下,</p>
<p>main函数的变量在text区域</p>
<p>然后放在esp的高位栈空间</p>
<p>变量的使用就push到低位栈空间</p>
<p>x64下</p>
<p>main函数的变量也是高位栈空间</p>
<p>但是你esp+32和ebp-8不都表示高位栈空间吗?于是x64用后者表示了数据分布</p>
<h2 id="高频"><a href="#高频" class="headerlink" title="高频"></a>高频</h2><h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><h4 id="x68"><a href="#x68" class="headerlink" title="x68"></a>x68</h4><p>就是定义在data区的变量</p>
<p>为什么说是全局?因为你可以跳过地址去访问那段一直不会消失的空间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">	xor eax,eax	</span><br><span class="line">.data </span><br><span class="line">temp dw 2001h</span><br><span class="line">.code</span><br><span class="line">	mov ax,temp</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样写的话,你的代码仍然会被放进data中,只不过是最后一个加入data的</p>
<h4 id="x64"><a href="#x64" class="headerlink" title="x64"></a>x64</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">section .data		</span><br><span class="line">		</span><br><span class="line">		var	dq	10.0		</span><br><span class="line">;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx	</span><br><span class="line">section .bss</span><br><span class="line"></span><br><span class="line">;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx	</span><br><span class="line">section .text</span><br><span class="line">							</span><br><span class="line">	global main						</span><br><span class="line">main:</span><br><span class="line">    mov rbp, rsp; for correct debugging</span><br></pre></td></tr></table></figure>

<p>于是你的var变量任意一个函数都可以访问</p>
<h3 id="有符号的立即数"><a href="#有符号的立即数" class="headerlink" title="有符号的立即数"></a>有符号的立即数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">		.386</span><br><span class="line">		.model flat,stdcall</span><br><span class="line">		option casemap:none</span><br><span class="line"></span><br><span class="line">	.data</span><br><span class="line">	.code</span><br><span class="line">start:</span><br><span class="line"></span><br><span class="line">		xor	edx,edx</span><br><span class="line">		xor	eax,eax</span><br><span class="line"></span><br><span class="line">		mov eax,-101</span><br><span class="line">		//eax=0xffffff9b</span><br><span class="line">		</span><br><span class="line">		mov eax,9Bh</span><br><span class="line">		//eax=9bh</span><br><span class="line">		</span><br><span class="line">		//9bh=-101</span><br><span class="line">				</span><br><span class="line">END start</span><br></pre></td></tr></table></figure>



<p>可以看到负数与他的16进制还是有很大的区别的</p>
<p>所以我们才会有定义有符号的变量</p>
<p>好比<code>var  sdword	-10</code></p>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>特点:地址连续,成员等宽</p>
<h4 id="8086数组"><a href="#8086数组" class="headerlink" title="8086数组"></a>8086数组</h4><h5 id="简要介绍"><a href="#简要介绍" class="headerlink" title="简要介绍"></a>简要介绍</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line">a db 1,2,3,4,5,6,7,8,9,10</span><br><span class="line">b dw 1,2,3,4,5,6,7,8,9,10</span><br><span class="line">start:</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<p>上面没有冒号<code>:</code></p>
<p>a其实代表了 1. <code>byte ptr cs:[0]</code> 2. <code>或者一个指向byte的指针</code></p>
<p>b的话就类推…..</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">code segment</span><br><span class="line">a db 1,2,3,4,5,6,7,8,9,10</span><br><span class="line">b dw 1,2,3,4,5,6,7,8,9,10</span><br><span class="line">start:</span><br><span class="line">    mov al,a;相当于mov al,cs:[0]</span><br><span class="line">    mov bx,b;mov bx,cs:[10],因为就是b就在cs的第10个位置</span><br><span class="line">    </span><br><span class="line">    mov a,66;相当于mov byte ptr cs:[0],66</span><br><span class="line">    mov b,88;相当于mov word ptr cs:[10],88</span><br><span class="line"></span><br><span class="line">    mov si,2</span><br><span class="line">    mov a[si],66;相当于mov byte ptr cs:[0+si],66;相当于mov byte ptr cs:0[si],66</span><br><span class="line">    </span><br><span class="line">    mov si,3</span><br><span class="line">    mov b[si],77;相当于mov word ptr cs:[10+si],66;相当于mov word ptr cs:10[si],66;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="指针数组"><a href="#指针数组" class="headerlink" title="指针数组"></a>指针数组</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data segment</span><br><span class="line">    arr db 3,2,1</span><br><span class="line">    sum dw 0</span><br><span class="line">    the_ptr dw arr,sum</span><br><span class="line">data ends</span><br></pre></td></tr></table></figure>



<h5 id="使用时的注意"><a href="#使用时的注意" class="headerlink" title="使用时的注意"></a>使用时的注意</h5><p>1️⃣假设你有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data segment</span><br><span class="line">    table db &quot;0123456789ABCDEF&quot;</span><br><span class="line">    index dw 0,0,0</span><br><span class="line">data ends</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对于table的读取,只能是table[纯数字,或者bx]</p>
<p>你需要一个中间变量的引用</p>
<p>如果用<code>mov ax,table[index]</code>就会报错,无论怎么修改类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">setscreen:</span><br><span class="line">            jmp short set</span><br><span class="line">    table   dw sub1,sub2,sub3,sub4</span><br><span class="line">    s:      </span><br><span class="line">            push bx</span><br><span class="line">            cmp ah,3</span><br><span class="line">            ja sret</span><br><span class="line">            mov bl,ah</span><br><span class="line">            mov bh,0</span><br><span class="line">            add bx,bx</span><br><span class="line"></span><br><span class="line">            call word ptr table[bx];重点在这里</span><br><span class="line">    sret:</span><br><span class="line">            pop bx</span><br><span class="line">            ret </span><br></pre></td></tr></table></figure>



<p>2️⃣错误源码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov          bx,index </span><br><span class="line">mov	byte ptr ds:[index],al</span><br><span class="line">inc	word ptr index </span><br></pre></td></tr></table></figure>

<p>IDA分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov     bx, word_10088</span><br><span class="line">mov     byte ptr word_10088, al</span><br><span class="line">inc     word_10088</span><br></pre></td></tr></table></figure>

<p>上面在直接对index写入,而不是[index]写入</p>
<p>正确的源码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov     bx,index </span><br><span class="line">mov		byte ptr [bx],al</span><br><span class="line">inc		word ptr index </span><br></pre></td></tr></table></figure>

<p>IDA</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov     bx, word_10088</span><br><span class="line">mov     [bx], al</span><br><span class="line">inc     word_10088</span><br></pre></td></tr></table></figure>

<p>其实他就是需要一个中间值的转化</p>
<p>后面关于x86的形式也是一样的</p>
<h4 id="x86数组"><a href="#x86数组" class="headerlink" title="x86数组"></a>x86数组</h4><h5 id="简要的介绍"><a href="#简要的介绍" class="headerlink" title="简要的介绍"></a>简要的介绍</h5><p>一个例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.data 	</span><br><span class="line">	Arr   BYTE  5,4,3,2,1</span><br><span class="line">	str1  BYTE  &quot;Dqx_Gh0st&quot;</span><br><span class="line">		  BYTE  &quot;I am fine!&quot;,0</span><br><span class="line">	str2   \</span><br><span class="line">		  db &quot;This is Function pf &#x27;\&#x27; !&quot;</span><br><span class="line">.stack </span><br><span class="line">	;db 16 dup(&#x27;S&#x27;)</span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<p>1️⃣.</p>
<p>值得注意的是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Arr   BYTE  5,4,3,2,1</span><br><span class="line">str1  BYTE  &quot;Dqx_Gh0st&quot;,0</span><br></pre></td></tr></table></figure>

<p>类似的声明它是不能在最后加上<code>,</code>逗号的,否者就报错</p>
<p>2️⃣.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str2 \</span><br><span class="line">		db &quot;This is Function pf &#x27;\&#x27; !&quot;</span><br></pre></td></tr></table></figure>



<p>关于第一行的<code>\</code></p>
<p>它的作用就是连接第2行的数据</p>
<p>于是上面的代码就等效于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str2 db &quot;This is Function pf &#x27;\&#x27; !&quot;</span><br></pre></td></tr></table></figure>

<p>它的作用就是一行写不下,另外一行</p>
<h5 id="如何调用数组"><a href="#如何调用数组" class="headerlink" title="如何调用数组"></a>如何调用数组</h5><p>源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov al,[Arr+1]</span><br><span class="line">mov ah,[str2+3]</span><br><span class="line">mov ax,Arr[2*6]</span><br><span class="line">mov ax,Arr[esi]</span><br><span class="line">mov ax,Arr[esi*(type arr)];C语言 Arr[index*sizeof(int)]</span><br></pre></td></tr></table></figure>

<p>在IDA里面它就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov     al, byte_405001</span><br><span class="line">mov     ah, byte_40501C</span><br><span class="line">mov     ax, byte_40500D</span><br><span class="line">mov     ax, byte_405010[esi]</span><br><span class="line">mov     ax, word_404000[esi*2]</span><br><span class="line">//间接寻址的方式会更加的好看</span><br></pre></td></tr></table></figure>

<p>这就是使用寄存器的好处.很直观</p>
<blockquote>
<p>另外注意的是</p>
<p>如果Arr是</p>
<p>db型, Arr+1就是Arr[1]</p>
<p>dw型,Arr+2*1才是Arr[1]</p>
<p>这不同于C语言,这里的每个++都是一个一个字节的处理</p>
</blockquote>
<h5 id="计算数组长度"><a href="#计算数组长度" class="headerlink" title="计算数组长度"></a>计算数组长度</h5><p>1️⃣$取地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr 	db 1,2,3,4,5,6</span><br><span class="line">arr_end	dd $</span><br><span class="line">len     =(arr_end-arr)/1</span><br><span class="line">//这个1是type arr</span><br></pre></td></tr></table></figure>



<p>2️⃣lengthof直接算个数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr db 1,2,3,4,5,</span><br><span class="line">		6,7,8,9,10</span><br><span class="line">len  =  lengthof arr</span><br></pre></td></tr></table></figure>



<h3 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h3><h4 id="汇编指针"><a href="#汇编指针" class="headerlink" title="汇编指针"></a>汇编指针</h4><p>后面我才遇到,指针类型是<code>ptr word</code>,</p>
<p>而指针的使用是<code>word ptr</code></p>
<p>这还是有很大的不同的</p>
<p><code> off_404012</code>&#x3D;&#x3D;*(0x404012)</p>
<p><code>off_404016</code>&#x3D;&#x3D;*(0x404016)</p>
<p> 而前面的word ptr或者byte ptr 只不过是强制类型转化</p>
<p>x86 指针用法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">title Dqx_Gh0st</span><br><span class="line"></span><br><span class="line">.386</span><br><span class="line">.MODEL flat,stdcall</span><br><span class="line">ExitProcess PROTO, dwExitCode:DWORD	</span><br><span class="line"></span><br><span class="line">db_ptr typedef ptr byte</span><br><span class="line">dw_ptr typedef ptr word</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">	arr1		db 9,8,7,6,5,4,3,2</span><br><span class="line">	arr2		dw 9,8,7,6,5,4,3,2,1</span><br><span class="line">	ptr1		dd arr1	</span><br><span class="line">	ptr2        dd arr2</span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	xor eax,eax                                                                                          		....</span><br><span class="line">	INVOKE	ExitProcess,0;调用结束的函数,</span><br><span class="line">;--------------------------------------------------------------------------- </span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>



<p>你用了一个中间值的转化</p>
<p>然后就接没有问题</p>
<p>(在8086也遇到过这种情况)</p>
<p>esi&#x3D;*(ptr1)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov esi,ptr1</span><br><span class="line">mov al,byte ptr [ esi+ (type arr1)*4]</span><br><span class="line">mov esi,ptr2</span><br><span class="line">mov ax,word ptr [esi+ (type arr2)*5]</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>错误的用法</p>
<p>直接使用指针</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xor eax,eax    </span><br><span class="line">mov al,byte ptr [ ptr1+ (type arr1)*4];错误的写法</span><br><span class="line">mov ax,word ptr [ ptr2+ (type arr2)*5];错误的写法</span><br><span class="line"></span><br><span class="line">xor eax,eax</span><br><span class="line">mov ax, word ptr  ptr1 [(type arr1)*4] ;错误的写法</span><br><span class="line">mov ax, word ptr  ptr2 [(type arr2)*5];错误的写法</span><br></pre></td></tr></table></figure>

<p>于是上面的ptr1就是变量ptr1的地址</p>
<p>*ptr1&#x3D;&amp;arr1</p>
<p><code>mov al,[ptr1+1*4]</code>都是错的</p>
<h4 id="反汇编和C指针"><a href="#反汇编和C指针" class="headerlink" title="反汇编和C指针"></a>反汇编和C指针</h4><p>x86</p>
<p>不管你是几级的指针,它的指针长度都是4字节</p>
<p>在反汇编结果里面也直接看不出来是几级指针</p>
<p>对于char*的指针</p>
<p>我们都知道,char* ptr 中ptr++是地址+1</p>
<p>对于char** ptr的指针,ptr++就是+4了</p>
<p>其它的可以类比</p>
<p>指针运算</p>
<p>(0).</p>
<p>​	指针不可以乘除,可以加减,   运算的结果是int类型</p>
<p>​	运算,明面上是x参与运算,实际上是x*sizeof(xxx)参与运算 </p>
<p>​	不同类型的指针,不可以运算</p>
<p>(2). 指针可以参与大小的比较</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span>**** x = (<span class="type">int</span>****)<span class="number">0</span>;</span><br><span class="line">	x=x+<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%p&quot;</span>, x);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后,x&#x3D;8 不用多说</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">short</span>* x = (<span class="type">short</span>*)<span class="number">100</span>;</span><br><span class="line">	<span class="type">short</span>* y = (<span class="type">short</span>*)<span class="number">200</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, y-x);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">		:50</span></span><br><span class="line"><span class="comment">		:D:\Code\Vs-2022\work\w1\Debug\w1.exe (进程 4116)已退出，代码为 0。</span></span><br><span class="line"><span class="comment">		:按任意键关闭此窗口. .</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>输出50…是因为<code>(200-100)/sizeof(short)</code></p>
<h3 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h3><p>[ebx+18]&#x3D;012</p>
<p>[ebx]&#x3D;0x12</p>
<p>提供[ebx+18]这种形式就大概可以看出他是结构体</p>
<blockquote>
<p> 特点: 结构体成员的地址连续,但是一般不是等宽</p>
</blockquote>
<p>如何理解?</p>
<p>一个地址指向了一个数据区域</p>
<p>这个区域有db,dw,dd,dq…..</p>
<p>然后通过指针可以访问这些数据</p>
<p>这个指针是第一个元素的地址</p>
<h4 id="对齐"><a href="#对齐" class="headerlink" title="对齐"></a>对齐</h4><p>如果结构体成员最大字节<code>&lt;</code>默认对齐字节大小 ,按照最大成员字节对齐,而不是默认对齐</p>
<p>如果最大成员字节大小&gt;默认对齐,按照默认对齐的方式对齐</p>
<p>就近原则对齐,从局部到整体</p>
<h4 id="声明与初始化"><a href="#声明与初始化" class="headerlink" title="声明与初始化"></a>声明与初始化</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.data </span><br><span class="line">my_struct struct</span><br><span class="line">    var1 db ?</span><br><span class="line">    var2 dw ?</span><br><span class="line">    var3 dd	?</span><br><span class="line">my_struct	ends</span><br><span class="line"> </span><br><span class="line">var1	my_truct	&lt;&gt;;不初始化</span><br><span class="line">var2	my_struct	&lt;1,2,3&gt;;初始话</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dqx_good STRUCT</span><br><span class="line">    IdNum BYTE    &quot;0000000&quot;  </span><br><span class="line">    LastName BYTE 20 DUP(0) </span><br><span class="line">    ALIGN word</span><br><span class="line">    Years WORD 0                        </span><br><span class="line">    ALIGN DWORD                         </span><br><span class="line">    SalaryHistory DWORD 0,0,0,0         </span><br><span class="line">dqx_good ENDS </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">person1 dqx_good &lt;&quot;2001&quot;,&quot;Dqx_Gh0st&quot;,100,&#123;4000h,,5000h,6000h&#125;&gt;</span><br><span class="line">//这是在声明的时候一起初始化</span><br></pre></td></tr></table></figure>



<p>对于变量1 IdNum 的初始化,如果你写入的数据小于预设长度,剩下的用空格填充,也就是0x20</p>
<p>对于变量2 LsatName 的初始化,如果你写入的数据小于预设长度,剩下的用0初始化</p>
<p><code>对于最后一个数组的初始话,要加一个大括号&#123;&#125;才可以不报错,否则报错</code></p>
<h4 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">node struct</span><br><span class="line">	num			dd			?</span><br><span class="line">	next		WNDCLASS	&lt;&gt;</span><br><span class="line">	stop_flag	db			?</span><br><span class="line">node ends</span><br><span class="line"></span><br><span class="line">x	node	&lt;20,,10&gt;</span><br><span class="line">//我们只是声明了外边2个变量,中间那个变量没有初始化</span><br></pre></td></tr></table></figure>





<p>用这种形式的话,我们要<code>assuem</code>一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov esi,offset var2</span><br><span class="line">assume esi:ptr my_struct_type //定义esi为my_struct_type这种数据类型</span><br><span class="line">mov al, [esi].db_var1</span><br><span class="line">assume esi:nothing//取消定义</span><br></pre></td></tr></table></figure>





<h4 id="结构体数组"><a href="#结构体数组" class="headerlink" title="结构体数组"></a>结构体数组</h4><p>假设有结构体</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dqx STRUCT</span><br><span class="line">    ID		BYTE &quot;000000000&quot;  </span><br><span class="line">    LastName	BYTE 20 DUP(0) </span><br><span class="line">    ALIGN word</span><br><span class="line">    year  WORD 0                        </span><br><span class="line">    ALIGN DWORD                         </span><br><span class="line">    salary DWORD 0,0,0,0         </span><br><span class="line">dqx ENDS </span><br></pre></td></tr></table></figure>



<p>然后定义一个数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr	dqx	15 dup (&lt; &gt;)</span><br></pre></td></tr></table></figure>

<p>调用它</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov esi,0</span><br><span class="line">arr[esi].year=100</span><br><span class="line">add	esi,type xx_struct</span><br><span class="line">arr[esi].num=200</span><br></pre></td></tr></table></figure>



<h4 id="包含结构体的结构体"><a href="#包含结构体的结构体" class="headerlink" title="包含结构体的结构体"></a>包含结构体的结构体</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a struct </span><br><span class="line">	x db ?</span><br><span class="line">	y db ?</span><br><span class="line">a ends</span><br><span class="line"></span><br><span class="line">b struct </span><br><span class="line">	z a &lt;&gt;</span><br><span class="line">	q a &lt;&gt;</span><br><span class="line">b ends</span><br><span class="line"></span><br><span class="line">;初始化一个变量</span><br><span class="line">dqx b &lt;&#123;1,2&#125;,&#123;3,4&#125;&gt;</span><br></pre></td></tr></table></figure>

<p>就这样就定义了一个包含结构体的结构体</p>
<p>使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mov	dqx.z.x,6</span><br><span class="line"></span><br><span class="line">mov	esi,offset dqx</span><br><span class="line">mov	(b ptr [esi]).z.y,7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mov	edi,OFFSET dqx.z</span><br><span class="line">mov	(a PTR [edi]).x, 8</span><br><span class="line"></span><br><span class="line">mov	edi,OFFSET dqx.z.y</span><br><span class="line">mov	byte PTR [edi], 9</span><br></pre></td></tr></table></figure>





<h4 id="内存布局"><a href="#内存布局" class="headerlink" title="内存布局"></a>内存布局</h4><p>他和数组在堆栈中的排布类似</p>
<p>第一个成员在栈上方</p>
<p>最后一个成员在栈下方</p>
<h3 id="联合体"><a href="#联合体" class="headerlink" title="联合体"></a>联合体</h3><p>一般的定义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Num UNION</span><br><span class="line">    D DWORD 1</span><br><span class="line">    W WORD 5</span><br><span class="line">    B BYTE 8</span><br><span class="line">Num ENDS</span><br></pre></td></tr></table></figure>

<p>把最大长度写在最前面,顺序呈降次</p>
<p>关于使用,Num的大小一直是最大尺度大小,也就是4字节</p>
<p>如果你初始化1字节,余下的字节就会用algin填充0,</p>
<p>1️⃣构体中的联合体</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stu1 STRUCT</span><br><span class="line">    ID1   Num &lt;&gt;</span><br><span class="line">    Name1 BYTE 4 DUP(&#x27;X&#x27;)</span><br><span class="line">stu1 ENDS</span><br><span class="line">//沿用Num联合体</span><br></pre></td></tr></table></figure>

<p>2️⃣在结构体里面声明,但是有点不一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">stu2 STRUCT</span><br><span class="line">    UNION ID2</span><br><span class="line">        D DWORD 70h</span><br><span class="line">        W WORD  80h</span><br><span class="line">        B BYTE  90h</span><br><span class="line">    ENDS</span><br><span class="line">    Name2 BYTE 4 DUP(&#x27;X&#x27;)</span><br><span class="line">stu2 ENDS</span><br></pre></td></tr></table></figure>

<p>很奇怪,他有2个ends</p>
<p>第一个没有写ID2 ends</p>
<blockquote>
<p> 注意事项1</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Num UNION	</span><br><span class="line">	D DWORD 60h</span><br><span class="line">	W WORD  70h</span><br><span class="line">	B BYTE  80h</span><br><span class="line">Num ENDS</span><br><span class="line"></span><br><span class="line">s1 Num &lt;12345678h&gt;</span><br><span class="line">mov	s1.B, 6</span><br></pre></td></tr></table></figure>

<p>虽然你初始化了s1.b&#x3D;6,但是以前的数据还是没有全部丢失,你只是覆盖了0x78为6</p>
<p>以前是0x12345678,现在是0x12345606</p>
<blockquote>
<p>注意事项2</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Num UNION	</span><br><span class="line">	D DWORD 60h</span><br><span class="line">	W WORD  70h</span><br><span class="line">	B BYTE  80h</span><br><span class="line">Num ENDS</span><br></pre></td></tr></table></figure>

<p>像这种声明,word,byte的数据会被dword掩盖,所以后面2句的初始化都是无效的</p>
<p>以供调试的代码</p>
<p>里面的字节对齐很有意思</p>
<p>algin的用法见目录篇:指令集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data</span><br><span class="line">;--------------------------------------------------------		                                         </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Num UNION	</span><br><span class="line">	D DWORD 60h</span><br><span class="line">	W WORD  70h</span><br><span class="line">	B BYTE  80h</span><br><span class="line">Num ENDS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">stu1 STRUCT</span><br><span class="line">    ID1   Num &lt;&gt;</span><br><span class="line">    Name1 BYTE 4 DUP(&#x27;X&#x27;)</span><br><span class="line">stu1 ENDS</span><br><span class="line"></span><br><span class="line">stu2 STRUCT</span><br><span class="line">    UNION ID2</span><br><span class="line">        D DWORD 70h</span><br><span class="line">        W WORD  80h</span><br><span class="line">        B BYTE  90h</span><br><span class="line">    ENDS</span><br><span class="line">    Name2 BYTE 4 DUP(&#x27;X&#x27;)</span><br><span class="line">stu2 ENDS</span><br><span class="line">	</span><br><span class="line">s1 Num &lt;12345678h&gt;</span><br><span class="line">s2 Num &lt;66h&gt;</span><br><span class="line">s3 Num  &lt; &gt;</span><br><span class="line">s4 stu1 &lt; &gt;</span><br><span class="line">s5 stu2 &lt; &gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">		;function</span><br><span class="line">		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">		.code</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">start:</span><br><span class="line">		</span><br><span class="line">		mov	s1.B, 6</span><br><span class="line">		mov	s2.W, 4</span><br><span class="line">		mov	s3.D, 5</span><br><span class="line"></span><br><span class="line">		mov	s4.ID1.B,9</span><br><span class="line">		mov	s5.ID2.W,8</span><br><span class="line"></span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">;function</span><br><span class="line">;----------------------------------------------------------</span><br><span class="line">end	start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>



<h3 id="宏"><a href="#宏" class="headerlink" title="宏"></a>宏</h3><p>宏实在IDA里面不会出现的,在编译阶段实现一个数据的初始化与填充</p>
<p>在源代码的开头我们有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">;------------------------------------------------------------------------</span><br><span class="line">x=1</span><br><span class="line">.386</span><br><span class="line">.MODEL flat,stdcall</span><br><span class="line">ExitProcess PROTO, dwExitCode:DWORD		</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">		xor eax,eax	</span><br><span class="line">		x=100</span><br><span class="line">		mov eax,x</span><br><span class="line">		x=1000</span><br><span class="line">		mov eax,x</span><br><span class="line">	INVOKE	ExitProcess,0;调用结束的函数,</span><br><span class="line">;--------------------------------------------------------------------------- </span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>

<p>一般会被定义位一个32位的数据长度</p>
<p>在汇编里面看到的是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">proc near               ; CODE XREF: start↑j</span><br><span class="line">xor     eax, eax</span><br><span class="line">mov     eax, 100</span><br><span class="line">mov     eax, 1000</span><br><span class="line">push    0               ; uExitCode</span><br><span class="line">call    j_ExitProcess</span><br><span class="line">sub_402028      endp</span><br></pre></td></tr></table></figure>

<p>可以看到,其实变量x并没有分配到内存,因为它不存在地址…</p>
<p>而且IDA里面也不会出现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x=100</span><br><span class="line">x=1000</span><br></pre></td></tr></table></figure>

<p>这些操作</p>
<p>可见它真的没有分配地址</p>
<p>正式因为这样才会有下面的错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push x</span><br><span class="line">x=6666</span><br><span class="line">pop x</span><br></pre></td></tr></table></figure>

<p>你可以push一个立即数,那是因为你有一个接收数据的地方</p>
<p>但是你不可以pop一个数据到立即数,就好比<code>pop 100</code></p>
<p>这一看就是一个大错误</p>
<h4 id="宏声明"><a href="#宏声明" class="headerlink" title="宏声明"></a>宏声明</h4><p>在调用宏过程时，其代码的副本将被直接插入到程序中该宏被调用的位置。相当于一个字符串替换</p>
<p>位置宏定义一般出现在程序源代码开始的位置，或者是放在独立文件中，再用 INCLUDE 伪指令复制到程序里。</p>
<p>所以的话,你应该封装一下你的函数</p>
<p>就像书上恶心的第三方库函数</p>
<p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">宏名称	macro</span><br><span class="line">    变量/指令</span><br><span class="line">	endm</span><br></pre></td></tr></table></figure>



<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line">ok	macro</span><br><span class="line">    mov al,&#x27;X&#x27;</span><br><span class="line">    mov bl,&#x27;Y&#x27;</span><br><span class="line">	endm</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data</span><br><span class="line"></span><br><span class="line">		.code</span><br><span class="line">		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">start:	</span><br><span class="line">		ok</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end	start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>于是在IDA的代码里面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public start</span><br><span class="line">start proc near</span><br><span class="line">mov     al, 58h ; &#x27;X&#x27;</span><br><span class="line">mov     bl, 59h ; &#x27;Y&#x27;</span><br><span class="line">push    0               ; uExitCode</span><br><span class="line">call    ExitProcess</span><br><span class="line">start endp</span><br></pre></td></tr></table></figure>

<h4 id="参数宏"><a href="#参数宏" class="headerlink" title="参数宏"></a>参数宏</h4><p>要在宏声明的时候,后面写几个参数就欧克</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line">m_ok	macro var1,var2</span><br><span class="line">    	mov al,var1</span><br><span class="line">    	mov bl,var2</span><br><span class="line">endm</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data</span><br><span class="line"></span><br><span class="line">		.code	</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">start:	</span><br><span class="line">		m_ok 97,98</span><br><span class="line">		</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end	start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>如果你的参数给错了,参数给少了,怎么办?</p>
<p>IDA</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public start</span><br><span class="line">start proc near</span><br><span class="line">mov     al, 97 ; &#x27;X&#x27;</span><br><span class="line">mov     bl, 98 ; &#x27;Y&#x27;</span><br><span class="line">push    0               ; uExitCode</span><br><span class="line">call    ExitProcess</span><br><span class="line">start endp</span><br></pre></td></tr></table></figure>







<h4 id="函数宏"><a href="#函数宏" class="headerlink" title="函数宏"></a>函数宏</h4><h5 id="普通版"><a href="#普通版" class="headerlink" title="普通版"></a>普通版</h5><p>这里有2个函数宏</p>
<p>第一个函数宏的功能是创建字符串,然后记录下他的地址</p>
<p>第二个函数宏的功能是创建字符串,他的地址无法二次引用</p>
<p>思考一下第二个宏,每一次创建的字符串都叫@string.是有问题的.所以我们才用了local来解决这个问题</p>
<p>值得注意的是,里面的.data与.code伪指令不要忘了,会引起很大的失误的</p>
<p>如果你的宏只是在data区建立的话,就用不上写data与code</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">makestr MACRO @name ,@text</span><br><span class="line">    .data</span><br><span class="line">    @name BYTE @text,0</span><br><span class="line">    .code</span><br><span class="line">ENDM</span><br><span class="line"></span><br><span class="line">makestring MACRO @text</span><br><span class="line">    LOCAL @string</span><br><span class="line">    .data</span><br><span class="line">    @string BYTE @text,0</span><br><span class="line">    .code</span><br><span class="line">ENDM</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:	</span><br><span class="line">		makestr str1,&quot;Gh0st&quot;</span><br><span class="line">		mov	esi,offset str1 </span><br><span class="line"></span><br><span class="line">		makestr str2,&quot;Dqx&quot;</span><br><span class="line">		mov	edi,offset str2</span><br><span class="line"></span><br><span class="line">		makestring &quot;Hello&quot;</span><br><span class="line">		makestring &quot;I am fine&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>





<h5 id="其他版"><a href="#其他版" class="headerlink" title="其他版"></a>其他版</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">isdefine macro button</span><br><span class="line">	ifdef  button</span><br><span class="line">		exitm&lt; 1 &gt;</span><br><span class="line">	else </span><br><span class="line">		exitm&lt; 0 &gt;</span><br><span class="line">	endif</span><br><span class="line">endm</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>exitm会返回一个数字给宏判断</p>
<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if ifdefine(flag)</span><br><span class="line">	include xx.inc</span><br><span class="line">else</span><br><span class="line">	include yy.inc</span><br><span class="line">endif</span><br></pre></td></tr></table></figure>

<p>差不多就这样用</p>
<p>后续遇到再补充</p>
<h4 id="宏嵌套"><a href="#宏嵌套" class="headerlink" title="宏嵌套"></a>宏嵌套</h4><p>就是在一个宏里面嵌套另外一个宏</p>
<p>类似于函数调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">makestr MACRO @name ,@text</span><br><span class="line">    .data</span><br><span class="line">    @name byte @text,0</span><br><span class="line">    .code</span><br><span class="line">    show @text</span><br><span class="line">ENDM</span><br><span class="line"></span><br><span class="line">show MACRO @text</span><br><span class="line">    echo @text</span><br><span class="line">ENDM</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:	</span><br><span class="line">		makestr str1,&quot;hi,Gh0st,I was created!&quot;</span><br><span class="line">		mov	esi,offset str1 </span><br><span class="line"></span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>



<h4 id="条件宏"><a href="#条件宏" class="headerlink" title="条件宏"></a>条件宏</h4><p>如果满足条件,就把某段代码进行编译,否则就不进行编译</p>
<p>下面字母的缩写</p>
<p>B:blank,空的意思</p>
<p>D:define</p>
<table>
<thead>
<tr>
<th>伪指令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>IF 表达式</td>
<td>若 expression 为真（非零）则允许汇编。可能的关系运算符为 LT、GT、EQ、NE、LE 和 GE</td>
</tr>
<tr>
<td>IFB &lt;var1,var2&gt;</td>
<td>如果没有实参传入形参,就返回true,指向语句块</td>
</tr>
<tr>
<td>IFNB &lt;var1,var2&gt;</td>
<td>如果非空,有参数的传进,就执行语句块</td>
</tr>
<tr>
<td>IFIDN&lt; arg1&gt;,&lt; arg2 &gt;</td>
<td>若两个实参相等（相同）则允许汇编。采用区分大小写的比较</td>
</tr>
<tr>
<td>IFIDNI&lt; arg1 &gt;,&lt; arg2&gt;</td>
<td>若两个实参相等（相同）则允许汇编。采用不区分大小写的比较</td>
</tr>
<tr>
<td>IFDIF&lt; arg1 &gt;,&lt; arg2&gt;</td>
<td>若两个实参不相等则允许汇编。采用区分大小写的比较</td>
</tr>
<tr>
<td>IFDIFI&lt; arg1&gt;,&lt; arg2&gt;</td>
<td>若两个实参不相等则允许汇编。采用不区分大小写的比较</td>
</tr>
<tr>
<td>IFDIF name</td>
<td>若 name 已定义则允许汇编</td>
</tr>
<tr>
<td>IFNDEF name</td>
<td>若 name 还未定义则允许汇编</td>
</tr>
<tr>
<td>ENDIF</td>
<td>结束用一个条件汇编伪指令开始的代码块</td>
</tr>
<tr>
<td>ELSE</td>
<td>若条件为真，则终止汇编之前的语句。若条件为假，ELSE 汇编语句直到遇到下一个 ENDIF</td>
</tr>
<tr>
<td>ELSEIF expression</td>
<td>若之前条件伪指令指定的条件为假，而当前表达式为真，则汇编全部语句直到出现 ENDIF</td>
</tr>
<tr>
<td>EXITM</td>
<td>立即退出宏，阻止所有后续宏语句的展开</td>
</tr>
</tbody></table>
<p>例子:检测参数列表</p>
<p>试了一下,可以正确的检测2个参数,如果2个参数传递不够,就会语法错误,而不是执行else的语句</p>
<p>对于一个参数,是可以正常检测是否有的,如果传入就指向语句块,否则指向else</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">makestr MACRO @name</span><br><span class="line"></span><br><span class="line">	ifnb &lt;@name&gt;</span><br><span class="line">		.data</span><br><span class="line">		@name byte &quot;hello,i am here&quot;,0</span><br><span class="line">		.code</span><br><span class="line">	else</span><br><span class="line">		echo haha,you are wrong</span><br><span class="line">	endif</span><br><span class="line">ENDM</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:	</span><br><span class="line">		makestr</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>



<p>后面详细的讲一下,条件宏</p>
<h4 id="宏调用的默认参数初始化"><a href="#宏调用的默认参数初始化" class="headerlink" title="宏调用的默认参数初始化"></a>宏调用的默认参数初始化</h4><p>如果我们传入的参数不够,我们可以用ifb来检测,但是我们也可以使用默认参数来解决问题</p>
<p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">宏名 macro 参数名:=&lt; xxx &gt;</span><br></pre></td></tr></table></figure>





<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">makestr MACRO @name:=&lt;Empty_name&gt;,@str:=&lt;&quot;no string&quot;&gt;</span><br><span class="line">		local @name</span><br><span class="line">		.data</span><br><span class="line">		@name byte @str,0</span><br><span class="line">		.code</span><br><span class="line">		mov esi,offset @name</span><br><span class="line">		push esi</span><br><span class="line">		add  esp,4</span><br><span class="line">ENDM</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:	</span><br><span class="line">		makestr str1,</span><br><span class="line">		makestr ,&quot;no name&quot;</span><br><span class="line">		makestr good,&quot;bad&quot;</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>



<p>上面之所以用local是因为,如果你一直不传入name的话,他会一直调用name作为关键字,导致name重复使用的语法错误</p>
<h4 id="布尔表达式"><a href="#布尔表达式" class="headerlink" title="布尔表达式"></a>布尔表达式</h4><p>之前说了一下宏条件的<code>if</code>条件</p>
<p>他后面的表达式可以是布尔表达式</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center"></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="center">LT</td>
<td align="center">little,小于的意思</td>
<td></td>
</tr>
<tr>
<td align="center">GT</td>
<td align="center">greate,大于的意思</td>
<td></td>
</tr>
<tr>
<td align="center">EQ</td>
<td align="center">equal,等于的意思</td>
<td></td>
</tr>
<tr>
<td align="center">NE</td>
<td align="center">not equal,不相等的意思</td>
<td></td>
</tr>
<tr>
<td align="center">LE</td>
<td align="center">little and equal ,表示小于等于</td>
<td></td>
</tr>
<tr>
<td align="center">GE</td>
<td align="center">greate and equal,大于等于</td>
<td></td>
</tr>
</tbody></table>
<p>好比这么用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (X LT 0) or (Y GT 79)</span><br><span class="line">	....</span><br></pre></td></tr></table></figure>



<h4 id="IF-x2F-ELSE-x2F-ENDIF"><a href="#IF-x2F-ELSE-x2F-ENDIF" class="headerlink" title="IF&#x2F;ELSE&#x2F;ENDIF"></a>IF&#x2F;ELSE&#x2F;ENDIF</h4><p>它后面可以接</p>
<p>整数常量</p>
<p>符号常量</p>
<p>常量</p>
<p>什么叫符号常量?什么叫整数常量</p>
<p>但不可以接寄存器或者变量名</p>
<p>常有的形式有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if </span><br><span class="line"></span><br><span class="line">endif</span><br></pre></td></tr></table></figure>

<p>还有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if</span><br><span class="line"></span><br><span class="line">esle</span><br><span class="line"></span><br><span class="line">endif</span><br></pre></td></tr></table></figure>



<h4 id="特殊运算符"><a href="#特殊运算符" class="headerlink" title="特殊运算符"></a>特殊运算符</h4><h5 id="amp-替换符号"><a href="#amp-替换符号" class="headerlink" title="&amp; 替换符号"></a>&amp; 替换符号</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">makestr MACRO b_name:=&lt;Empty_name&gt;,b_str:=&lt;no string&gt;</span><br><span class="line">		local b_name</span><br><span class="line">		.data</span><br><span class="line">		b_name byte &amp;b_str,0</span><br><span class="line">		.code</span><br><span class="line">		mov esi,offset b_name</span><br><span class="line">ENDM</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:	</span><br><span class="line">		makestr one, &quot;I was a str!&quot;</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>你的参数<code>&quot;I was a str!&quot;</code>会用在&amp;b_str,然后直接别替换掉</p>
<p>感觉没太大的用</p>
<p>而且与原来的用法有什么区别我还不知道</p>
<h5 id="格式转化"><a href="#格式转化" class="headerlink" title="% 格式转化"></a>% 格式转化</h5><p>在TEXTEQU的运用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">;makestr MACRO </span><br><span class="line"></span><br><span class="line">;ENDM</span><br><span class="line">Digit = 4</span><br><span class="line">Num textequ %(Digit+5)</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:		</span><br><span class="line">	</span><br><span class="line">		mov eax,Num</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>



<p>在之前我们也有提及textequ的宏</p>
<p>例子1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">;makestr MACRO </span><br><span class="line"></span><br><span class="line">;ENDM</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">arr db 9 dup(&#x27;C&#x27;)		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:		</span><br><span class="line">	</span><br><span class="line">		echo The arr contains (SIZEOF arr) bytes	;wrong</span><br><span class="line">		echo The arr contains %(SIZEOF arr) bytes	;wrong</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		how_many textequ %(SIZEOF arr)				;正确的</span><br><span class="line">		% echo The arr contains how_many bytes</span><br><span class="line"></span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Microsoft (R) Program Maintenance Utility Version 14.31.31105.0</span><br><span class="line">Copyright (C) Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line">        ml /c /coff x.asm</span><br><span class="line">Microsoft (R) Macro Assembler Version 6.14.8444</span><br><span class="line">Copyright (C) Microsoft Corp 1981-1997.  All rights reserved.</span><br><span class="line"></span><br><span class="line"> Assembling: x.asm</span><br><span class="line"></span><br><span class="line">***********</span><br><span class="line">ASCII build</span><br><span class="line">***********</span><br><span class="line"></span><br><span class="line">The arr contains (SIZEOF arr) bytes</span><br><span class="line">The arr contains %(SIZEOF arr) bytes</span><br><span class="line">The arr contains 9 bytes</span><br><span class="line"></span><br><span class="line">        Link /subsystem:windows x.obj</span><br><span class="line">Microsoft (R) Incremental Linker Version 5.12.8078</span><br><span class="line">Copyright (C) Microsoft Corp 1992-1998. All rights reserved.</span><br></pre></td></tr></table></figure>

<p>例子2</p>
<p>代码的功能就是实现 val3 &#x3D; val1 * val2</p>
<p>里面有个检测</p>
<p>我们都知道乘法的eax是作为第一个因素的,不能作为第二个</p>
<p>所以这里有个检测</p>
<p>正确的代码,输出结果无</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MUL32 MACRO op1, op2, product</span><br><span class="line">	ifidni &lt;op2&gt;,&lt;eax&gt;</span><br><span class="line">	  line_Num TEXTEQU %(@LINE)</span><br><span class="line"></span><br><span class="line">	  ECHO xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">%	  ECHO *  Error on line line_Num: EAX cannot be as the second var</span><br><span class="line">	  ECHO *  argument when invoking the MUL32 macro.</span><br><span class="line">	  ECHO xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line"></span><br><span class="line">	exitm</span><br><span class="line">	;</span><br><span class="line">	endif</span><br><span class="line">	push eax</span><br><span class="line">	mov  eax,op1</span><br><span class="line">	mul  op2</span><br><span class="line">	mov  product,eax</span><br><span class="line">	pop  eax</span><br><span class="line">ENDM</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">val1   DWORD 3</span><br><span class="line">val2   DWORD 2</span><br><span class="line">result DWORD ?		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:		</span><br><span class="line">	;MUL32 val1,val2,result		; val3 = val1 * val2</span><br><span class="line"></span><br><span class="line">	mov eax,val1</span><br><span class="line">	MUL32 eax,val2,result</span><br><span class="line"></span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>错误的代码,把eax作为了第二个参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MUL32 MACRO op1, op2, product</span><br><span class="line">	ifidni &lt;op2&gt;,&lt;eax&gt;</span><br><span class="line">	  line_Num TEXTEQU %(@LINE)</span><br><span class="line"></span><br><span class="line">	  ECHO xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">%	  ECHO *  Error on line line_Num: EAX cannot be as the second var</span><br><span class="line">	  ECHO *  argument when invoking the MUL32 macro.</span><br><span class="line">	  ECHO xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line"></span><br><span class="line">	exitm</span><br><span class="line">	;exit会退出所有的宏定义,意思就是下面的语句不再执行</span><br><span class="line">	;虽然我们可以通过elseif来不执行</span><br><span class="line">	endif</span><br><span class="line">	push eax</span><br><span class="line">	mov  eax,op1</span><br><span class="line">	mul  op2</span><br><span class="line">	mov  product,eax</span><br><span class="line">	pop  eax</span><br><span class="line">ENDM</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">val1   DWORD 3</span><br><span class="line">val2   DWORD 2</span><br><span class="line">result DWORD ?		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:		</span><br><span class="line">	;MUL32 val1,val2,result		; val3 = val1 * val2</span><br><span class="line"></span><br><span class="line">	mov   eax,val1</span><br><span class="line">	MUL32 val2,eax,result</span><br><span class="line"></span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Microsoft (R) Program Maintenance Utility Version 14.31.31105.0</span><br><span class="line">Copyright (C) Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line">        ml /c /coff x.asm</span><br><span class="line">Microsoft (R) Macro Assembler Version 6.14.8444</span><br><span class="line">Copyright (C) Microsoft Corp 1981-1997.  All rights reserved.</span><br><span class="line"></span><br><span class="line"> Assembling: x.asm</span><br><span class="line"></span><br><span class="line">***********</span><br><span class="line">ASCII build</span><br><span class="line">***********</span><br><span class="line"></span><br><span class="line">x.asm(36) : error A2006: undefined symbol : @LINE</span><br><span class="line"> MUL32(2): Macro Called From</span><br><span class="line">  x.asm(36): Main Line Code</span><br><span class="line">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">*  Error on line 0: eax cannot be as the second var</span><br><span class="line">*  argument when invoking the MUL32 macro.</span><br><span class="line">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">NMAKE : fatal error U1077: &#x27;D:\Back\C0de_IDE\Asm\x86\masm32\bin\ml.EXE&#x27; : return code &#x27;0x1&#x27;</span><br><span class="line">Stop.</span><br></pre></td></tr></table></figure>





<h5 id="lt-gt-文字文本替换符"><a href="#lt-gt-文字文本替换符" class="headerlink" title="&lt; &gt; 文字文本替换符"></a>&lt; &gt; 文字文本替换符</h5><p>他会把&lt;&gt;里的内容当做一个文本的整体导入,这个文本不是浅层意义字符串,而是xxx,就像你现在打的字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make macro t_str</span><br><span class="line">	local t_name</span><br><span class="line">	.data </span><br><span class="line">	t_name byte t_str,0</span><br><span class="line">	.code </span><br><span class="line">	mov esi,offset t_name</span><br><span class="line">endm</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:		</span><br><span class="line">		make    &quot;I am here&quot;,0Dh,0Ah</span><br><span class="line">		make    &lt;&quot;I am there&quot;,0Dh,0Ah&gt;</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>0Dh是回车,0Ah是换行</p>
<p>第一个语句看似像给str传入”I am here”,0Dh,0Ah,但是被识别为3个参数,编译器发出警告,然后舍弃最后2个参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x.asm(17) : warning A4006: too many arguments in macro call</span><br><span class="line"> make(1): Macro Called From</span><br></pre></td></tr></table></figure>



<p>然后第二种写法才是把他们当做一个整体写入</p>
<p>IDA</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.data:00403000 aIAmHere        db &#x27;I am here&#x27;,0        ; DATA XREF: start↑o</span><br><span class="line">.data:0040300A aIAmThere       db &#x27;I am there&#x27;,0Dh,0Ah,0</span><br><span class="line">.data:0040300A                                         ; DATA XREF: start+5↑o</span><br><span class="line">.data:00403017                 align 1000h</span><br></pre></td></tr></table></figure>



<h5 id="强制处理运算符"><a href="#强制处理运算符" class="headerlink" title="!  强制处理运算符"></a>!  强制处理运算符</h5><p>在C语言里面我们有转移字符</p>
<p>好比\n转义为换行</p>
<p>在masm里面,!的作用好比这个</p>
<p>多的也不说,感觉没怎么用</p>
<h4 id="宏循环"><a href="#宏循环" class="headerlink" title="宏循环"></a>宏循环</h4><h5 id="while"><a href="#while" class="headerlink" title="while"></a>while</h5><p>看代码会更加的清晰</p>
<p>一个斐波拉契数列,后一项是前2项的sum</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">x=1</span><br><span class="line">y=1</span><br><span class="line">byte x</span><br><span class="line">byte y</span><br><span class="line">z=x+y</span><br><span class="line">while z LT 10</span><br><span class="line">	byte z</span><br><span class="line">	x=y</span><br><span class="line">	y=z</span><br><span class="line">	z=x+y</span><br><span class="line">endm</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:		</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>



<p>他的效果是个啥????</p>
<p>首先我们创建了2个变量,x和y</p>
<p>然后利用循环不断的创建z变量</p>
<p>最后在data区我们得到了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.data:00403000                 ;org 403000h</span><br><span class="line">.data:00403000                 db    1</span><br><span class="line">.data:00403001                 db    1</span><br><span class="line">.data:00403002                 db    2</span><br><span class="line">.data:00403003                 db    3</span><br><span class="line">.data:00403004                 db    5</span><br><span class="line">.data:00403005                 db    8</span><br><span class="line">.data:00403006                 db    0</span><br><span class="line">.data:00403007                 db    0</span><br></pre></td></tr></table></figure>



<h5 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h5><p>与dup类似</p>
<p>它适用于有一定次数的循环</p>
<p>用法是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">repeat 循环次数</span><br><span class="line">	xxx</span><br><span class="line">endm</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">count=10</span><br><span class="line">xy	struct</span><br><span class="line">	x byte 10h</span><br><span class="line">	y byte 23h</span><br><span class="line">xy	ends</span><br><span class="line"></span><br><span class="line">zq	struct</span><br><span class="line">	z byte 34h</span><br><span class="line">	q byte 56h</span><br><span class="line">zq	ends</span><br><span class="line"></span><br><span class="line">xyzq	struct</span><br><span class="line"></span><br><span class="line">	repeat count</span><br><span class="line">	local b_xy,b_zq</span><br><span class="line">	b_xy xy &lt;&gt;</span><br><span class="line">	b_zq zq &lt;&gt;</span><br><span class="line">	endm</span><br><span class="line"></span><br><span class="line">xyzq	ends</span><br><span class="line"></span><br><span class="line">one xyzq &lt;&gt;</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:		</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>



<p>在data区的效果,创建了10个xy,zq的变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">.data:00403000                 ;org 403000h</span><br><span class="line">.data:00403000                 db  10h</span><br><span class="line">.data:00403001                 db  23h ; #</span><br><span class="line">.data:00403002                 db  34h ; 4</span><br><span class="line">.data:00403003                 db  56h ; V</span><br><span class="line">.data:00403004                 db  10h</span><br><span class="line">.data:00403005                 db  23h ; #</span><br><span class="line">.data:00403006                 db  34h ; 4</span><br><span class="line">.data:00403007                 db  56h ; V</span><br><span class="line">.data:00403008                 db  10h</span><br><span class="line">.data:00403009                 db  23h ; #</span><br><span class="line">.data:0040300A                 db  34h ; 4</span><br><span class="line">.data:0040300B                 db  56h ; V</span><br><span class="line">.data:0040300C                 db  10h</span><br><span class="line">.data:0040300D                 db  23h ; #</span><br><span class="line">.data:0040300E                 db  34h ; 4</span><br><span class="line">.data:0040300F                 db  56h ; V</span><br><span class="line">.data:00403010                 db  10h</span><br><span class="line">.data:00403011                 db  23h ; #</span><br><span class="line">.data:00403012                 db  34h ; 4</span><br><span class="line">.data:00403013                 db  56h ; V</span><br><span class="line">.data:00403014                 db  10h</span><br><span class="line">.data:00403015                 db  23h ; #</span><br><span class="line">.data:00403016                 db  34h ; 4</span><br><span class="line">.data:00403017                 db  56h ; V</span><br><span class="line">.data:00403018                 db  10h</span><br><span class="line">.data:00403019                 db  23h ; #</span><br><span class="line">.data:0040301A                 db  34h ; 4</span><br><span class="line">.data:0040301B                 db  56h ; V</span><br><span class="line">.data:0040301C                 db  10h</span><br><span class="line">.data:0040301D                 db  23h ; #</span><br><span class="line">.data:0040301E                 db  34h ; 4</span><br><span class="line">.data:0040301F                 db  56h ; V</span><br><span class="line">.data:00403020                 db  10h</span><br><span class="line">.data:00403021                 db  23h ; #</span><br><span class="line">.data:00403022                 db  34h ; 4</span><br><span class="line">.data:00403023                 db  56h ; V</span><br><span class="line">.data:00403024                 db  10h</span><br><span class="line">.data:00403025                 db  23h ; #</span><br><span class="line">.data:00403026                 db  34h ; 4</span><br><span class="line">.data:00403027                 db  56h ; V</span><br><span class="line">.data:00403028                 db    0</span><br><span class="line">.data:00403029                 db    0</span><br></pre></td></tr></table></figure>







<h5 id="for-循环取整数"><a href="#for-循环取整数" class="headerlink" title="for 循环取整数"></a>for 循环取整数</h5><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for name,&lt;name1,name2,name3&gt;</span><br><span class="line">	xx</span><br><span class="line">endm</span><br></pre></td></tr></table></figure>



<p>看例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">count=10</span><br><span class="line">xy	struct</span><br><span class="line">	x byte 55h</span><br><span class="line">	y byte 66h</span><br><span class="line">xy	ends</span><br><span class="line"></span><br><span class="line">for b_name,&lt;one,two,three,four,five,six&gt;</span><br><span class="line">    b_name xy &lt;&gt;</span><br><span class="line">endm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for b_value,&lt;97,98,99,100,101,102&gt;</span><br><span class="line">	local b_name</span><br><span class="line">	b_name byte b_value</span><br><span class="line">endm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;for b_value,&#123;&lt;97,98&gt;,&lt;99,100&gt;,&lt;101,102&gt;&#125;</span><br><span class="line">	;local b_name</span><br><span class="line">	;b_name xy b_value</span><br><span class="line">;endm</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:		</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>最后在IDA的DATA区域得到的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">data:00403000                 ;org 403000h</span><br><span class="line">.data:00403000                 db  55h ; U</span><br><span class="line">.data:00403001                 db  66h ; f</span><br><span class="line">.data:00403002                 db  55h ; U</span><br><span class="line">.data:00403003                 db  66h ; f</span><br><span class="line">.data:00403004                 db  55h ; U</span><br><span class="line">.data:00403005                 db  66h ; f</span><br><span class="line">.data:00403006                 db  55h ; U</span><br><span class="line">.data:00403007                 db  66h ; f</span><br><span class="line">.data:00403008                 db  55h ; U</span><br><span class="line">.data:00403009                 db  66h ; f</span><br><span class="line">.data:0040300A                 db  55h ; U</span><br><span class="line">.data:0040300B                 db  66h ; f</span><br><span class="line">.data:0040300C                 db  61h ; a</span><br><span class="line">.data:0040300D                 db  62h ; b</span><br><span class="line">.data:0040300E                 db  63h ; c</span><br><span class="line">.data:0040300F                 db  64h ; d</span><br><span class="line">.data:00403010                 db  65h ; e</span><br><span class="line">.data:00403011                 db  66h ; f</span><br><span class="line">.data:00403012                 db    0</span><br><span class="line">.data:00403013                 align 1000h</span><br><span class="line">.data:00403013 _data           ends</span><br><span class="line">.data:00403013</span><br><span class="line">.data:00403013</span><br><span class="line">.data:00403013                 end start</span><br></pre></td></tr></table></figure>



<h5 id="forc-循环取字符"><a href="#forc-循环取字符" class="headerlink" title="forc 循环取字符"></a>forc 循环取字符</h5><p>与上一个例子类似</p>
<p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">forc &lt;无双引号的字符串&gt;</span><br><span class="line">	xx</span><br><span class="line">endm</span><br></pre></td></tr></table></figure>

<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">forc code,&lt;!@#$%^&amp;*!&gt;!&lt;&gt;</span><br><span class="line">    byte &quot;&amp;code&quot;</span><br><span class="line">endm</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:		</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>在IDA的data区域</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.data:00403000                 ;org 403000h</span><br><span class="line">.data:00403000                 db &#x27;@#$%^&amp;*&gt;&lt;&#x27;,0</span><br><span class="line">.data:0040300A                 align 1000h</span><br></pre></td></tr></table></figure>



<h4 id="REQ"><a href="#REQ" class="headerlink" title="REQ"></a>REQ</h4><p>不知道什么鬼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line">m_ok	macro var1:REQ,var2:REQ</span><br><span class="line">    mov al,var1</span><br><span class="line">    mov bl,var2</span><br><span class="line">	endm</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data</span><br><span class="line"></span><br><span class="line">		.code</span><br><span class="line">		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">start:	</span><br><span class="line">		m_ok 97,98		</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end	start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>



<h4 id="ECHO"><a href="#ECHO" class="headerlink" title="ECHO"></a>ECHO</h4><p>不知道什么鬼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">m_ok	macro var1:REQ,var2:REQ</span><br><span class="line">	    ECHO  hello,I am link and masm</span><br><span class="line">        mov al,var1</span><br><span class="line">        mov bl,var2		</span><br><span class="line">	    endm</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data</span><br><span class="line"></span><br><span class="line">		.code</span><br><span class="line">		</span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">start:	</span><br><span class="line">		m_ok 97,98</span><br><span class="line">		ECHO  hello,I am Dqx_Gh0st</span><br><span class="line">		</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end	start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>ECHO的效果就是在输出字符串,不过在运行时不会输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Microsoft (R) Program Maintenance Utility Version 14.31.31105.0</span><br><span class="line">Copyright (C) Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line">        ml /c /coff x.asm</span><br><span class="line">Microsoft (R) Macro Assembler Version 6.14.8444</span><br><span class="line">Copyright (C) Microsoft Corp 1981-1997.  All rights reserved.</span><br><span class="line"></span><br><span class="line"> Assembling: x.asm</span><br><span class="line"></span><br><span class="line">***********</span><br><span class="line">ASCII build</span><br><span class="line">***********</span><br><span class="line"></span><br><span class="line">hello,I am link and masm</span><br><span class="line">hello,I am Dqx_Gh0st</span><br><span class="line">        Link /subsystem:windows x.obj</span><br><span class="line">Microsoft (R) Incremental Linker Version 5.12.8078</span><br><span class="line">Copyright (C) Microsoft Corp 1992-1998. All rights reserved.</span><br></pre></td></tr></table></figure>

<p>于是上面那里就输出了<code>hello,I am Dqx_Gh0st</code></p>
<p>但是运行x.exe是不会有输出的,就连调试也不会</p>
<h4 id="x64宏"><a href="#x64宏" class="headerlink" title="x64宏"></a>x64宏</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">; macro.asm</span><br><span class="line">extern printf</span><br><span class="line"></span><br><span class="line">%define	double_it(r)	sal r, 1	;这里带有参数</span><br><span class="line"></span><br><span class="line">%macro	prntf	2					;2代表了2个参数,参数1是%1,参数2是%2</span><br><span class="line">	section .data</span><br><span class="line">			%%arg1	db	%1,0        ; first argument</span><br><span class="line">			%%fmtint	db	&quot;%s %ld&quot;,10,0 	; formatstring</span><br><span class="line">	section .text				; the printf arguments</span><br><span class="line">		mov	rdi, %%fmtint</span><br><span class="line">		mov	rsi, %%arg1</span><br><span class="line">		mov	rdx,[%2]        ; second argument</span><br><span class="line">		mov	rax,0           ; no floating point  </span><br><span class="line">		call printf</span><br><span class="line">%endmacro</span><br><span class="line"></span><br><span class="line">section .data							</span><br><span class="line">	number	dq	15					</span><br><span class="line">section .bss</span><br><span class="line">section .text							</span><br><span class="line">	global main						</span><br><span class="line">main:</span><br><span class="line">	push rbp</span><br><span class="line">	mov rbp,rsp</span><br><span class="line">	prntf 	&quot;The number is&quot;, number</span><br><span class="line">	mov 	rax, [number]</span><br><span class="line">	double_it(rax)</span><br><span class="line">	mov 	[number],rax</span><br><span class="line">	prntf 	&quot;The number times 2 is&quot;, number</span><br><span class="line">	leave</span><br><span class="line">	ret	</span><br></pre></td></tr></table></figure>





<p><code>单行宏</code>以%define开头</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%define	double_it(r)	sal r, 1	;这里带有参数</span><br></pre></td></tr></table></figure>

<p>这个r是参数</p>
<p>根据寄存器的约束[见内联汇编扩展篇]</p>
<p>这个r的意思应该是任意寄存器的意思,也就是传入的参数可以使任意寄存器</p>
<p><code>多行宏</code>用%macro与%endmacro来包含</p>
<p>包含了宏的名字,参数个数</p>
<p>局部变量用<code>%%</code>开头,其实也不是非要用</p>
<p>这个的意思就是local差不多的意思…保证参数的名字不会重复</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%%arg1</span><br><span class="line">%%fmtint</span><br></pre></td></tr></table></figure>

<p>参数用<code>%</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%1 代表了第一个参数</span><br><span class="line">%2 代表了第二个参数</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">%macro	prntf	2					;2代表了2个参数,参数1是%1,参数2是%2</span><br><span class="line">	section .data</span><br><span class="line">			%%arg1	db	%1,0        ; first argument</span><br><span class="line">			%%fmtint	db	&quot;%s %ld&quot;,10,0 	; formatstring</span><br><span class="line">	section .text				; the printf arguments</span><br><span class="line">		mov	rdi, %%fmtint</span><br><span class="line">		mov	rsi, %%arg1</span><br><span class="line">		mov	rdx,[%2]        ; second argument</span><br><span class="line">		mov	rax,0           ; no floating point  </span><br><span class="line">		call printf</span><br><span class="line">%endmacro</span><br></pre></td></tr></table></figure>







<h3 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h3><h4 id="第一次尝试"><a href="#第一次尝试" class="headerlink" title="第一次尝试"></a>第一次尝试</h4><p>第一次尝试,失败</p>
<p>还不知道为什么</p>
<p>关于书上的例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">..........</span><br><span class="line">; 数据段</span><br><span class="line">.data</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">node struct</span><br><span class="line">	num	dd		?</span><br><span class="line">	next	WNDCLASS	&lt;&gt;</span><br><span class="line">node ends</span><br><span class="line"></span><br><span class="line">x	node	&lt;20,&gt;</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">; 代码段</span><br><span class="line">.code</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;	</span><br><span class="line">start:</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">		xor eax,eax</span><br><span class="line">		mov esi,offset x</span><br><span class="line">		assume esi: ptr node</span><br><span class="line">		mov eax,[esi].next.lpfnWndProc</span><br><span class="line">		assume esi:nothing</span><br><span class="line">.....</span><br></pre></td></tr></table></figure>





<p>失败了,不知道为什么….</p>
<p>反正我写就是报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">.data</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">node struct</span><br><span class="line">	num	dd		?</span><br><span class="line">	next	dd		&lt;&gt;</span><br><span class="line">node ends</span><br><span class="line"></span><br><span class="line">x	node	&lt;20,offset y&gt;</span><br><span class="line">y	node	&lt;10,offset x&gt;</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">; 代码段</span><br><span class="line">.code</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;	</span><br><span class="line">start:</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">		xor	eax,eax</span><br><span class="line">		mov	esi,offset x</span><br><span class="line">		assume	esi: ptr node</span><br><span class="line">		mov	eax,[esi].next.num</span><br><span class="line">		assume	esi:nothing</span><br><span class="line">		push 0</span><br><span class="line">		call ExitProcess</span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>



<h4 id="第二次尝试"><a href="#第二次尝试" class="headerlink" title="第二次尝试"></a>第二次尝试</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">include		Dqx.inc</span><br><span class="line"></span><br><span class="line">;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">		.data	</span><br><span class="line">node	struct</span><br><span class="line">	value		dword	6</span><br><span class="line">	next_ptr	dword	6</span><br><span class="line">node	ends</span><br><span class="line"></span><br><span class="line">count=0</span><br><span class="line"></span><br><span class="line">train_head	label	ptr node</span><br><span class="line">repeat	5</span><br><span class="line">	count=count+1</span><br><span class="line">	node &lt;,$+count*(type node)&gt;	</span><br><span class="line">endm</span><br><span class="line"></span><br><span class="line">train_tail label ptr node</span><br><span class="line">node &lt;0,0&gt;</span><br><span class="line"></span><br><span class="line">;--------------------------------------------------------</span><br><span class="line">.code</span><br><span class="line">start:		</span><br><span class="line">		mov	esi,train_head</span><br><span class="line">		mov	edi,train_tail</span><br><span class="line">check_continue:</span><br><span class="line">		mov	ecx,(node ptr [esi]).next_ptr</span><br><span class="line">		cmp	ecx,0</span><br><span class="line">		je	over</span><br><span class="line">		add	esi,type node</span><br><span class="line">		jmp	check_continue</span><br><span class="line">	over:</span><br><span class="line">		echo	i find it</span><br><span class="line">		invoke	ExitProcess,NULL</span><br><span class="line">end start</span><br><span class="line">;-----------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>代码的作用是</p>
<p>建立5个链表</p>
<p>建立一个尾巴链表,他的next指针为null</p>
<p>然后查询链表,查到就退出</p>
<p>IDA的data区</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.data:00403000                 ;org 403000h</span><br><span class="line">.data:00403000 dword_403000    dd 6                    ; DATA XREF: start↑r</span><br><span class="line">.data:00403004                 dd offset dword_403008</span><br><span class="line">.data:00403008 dword_403008    dd 6                    ; DATA XREF: .data:00403004↑o</span><br><span class="line">.data:0040300C                 dd offset dword_403010</span><br><span class="line">.data:00403010 dword_403010    dd 6                    ; DATA XREF: .data:0040300C↑o</span><br><span class="line">.data:00403014                 dd offset dword_403018</span><br><span class="line">.data:00403018 dword_403018    dd 6                    ; DATA XREF: .data:00403014↑o</span><br><span class="line">.data:0040301C                 dd offset dword_403020</span><br><span class="line">.data:00403020 dword_403020    dd 6                    ; DATA XREF: .data:0040301C↑o</span><br><span class="line">.data:00403024                 dd offset dword_403028</span><br><span class="line">.data:00403028 dword_403028    dd 0                    ; DATA XREF: start+6↑r</span><br><span class="line">.data:00403028                                         ; .data:00403024↑o</span><br><span class="line">.data:0040302C                 dd 0</span><br></pre></td></tr></table></figure>







<h2 id="低频"><a href="#低频" class="headerlink" title="低频"></a>低频</h2><h3 id="real"><a href="#real" class="headerlink" title="real"></a>real</h3><p>&lt;&lt;汇编语言基于x86处理器&gt;&gt;的Page56</p>
<p>里面有个real实数类型…也就是浮点数的意思</p>
<h3 id="BCD"><a href="#BCD" class="headerlink" title="BCD"></a>BCD</h3><p>还有一个BCD编码</p>
<p>&lt;&lt;汇编语言基于x86处理器&gt;&gt;的Page61</p>
<h3 id="label-数据类型"><a href="#label-数据类型" class="headerlink" title="label 数据类型"></a>label 数据类型</h3><p>用法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b_var label word</span><br></pre></td></tr></table></figure>

<p>变量b_var的值就是紧挨着下一个word类型变量的地址</p>
<p>它指向一个word的数据类型</p>
<p>编译器也不会给label类型分配内存,它会与下一个数据共享一个位置</p>
<p>于是我们就可以不用offset了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.386</span><br><span class="line">.MODEL flat,stdcall</span><br><span class="line">ExitProcess PROTO, dwExitCode:DWORD		</span><br><span class="line">.data</span><br><span class="line">	arr_label label word;IDA不会出现这句话</span><br><span class="line">	arr		  dd 12345678h;arr的低4位地址的数据与arr_label共享</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main PROC</span><br><span class="line">	</span><br><span class="line">	xor eax,eax</span><br><span class="line">	mov ax,arr_label;直接使用名字可以访问指针指向的值</span><br><span class="line">	xor eax,eax</span><br><span class="line">	mov ax,[arr_label+1]</span><br><span class="line"></span><br><span class="line">	INVOKE	ExitProcess,0;调用结束的函数,</span><br><span class="line">;--------------------------------------------------------------------------- </span><br><span class="line">main ENDP</span><br><span class="line">END main</span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov ax,arr_label;直接使用名字可以访问指针指向的值</span><br></pre></td></tr></table></figure>

<p>因为arr_label指向word,所以我们用ax|16位来接收,只能接收<code>12345678h</code>的低位4字节</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov ax,[arr_label+1]</span><br></pre></td></tr></table></figure>

<p>+1是字节+1</p>
<p>12345678h的低位[1]开始于是获取了3456h</p>


<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>许可协议</span></div><div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/re4mile/2021/06/07/language/Asm/windwos/32/%E5%B0%8F%E4%B8%93%E9%A2%98/CRT%E6%A0%87%E5%87%86%E5%BA%93/language/">x86汇编 CRT标准库</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/re4mile/2021/06/07/language/Asm/windwos/32/%E6%8C%87%E4%BB%A4/language/">x86汇编语言实践部分</a></div></section></div>






  <div class='related-wrap md-text reveal' id="comments">
    <section class='header cmt-title cap theme'>
      快来参与讨论吧
    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



      
<footer class="page-footer reveal fs12"><hr><div class="text"><p>本站由 <a href="/">@anonymity</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>

      <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  const stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.18.5';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.18.5';
  stellar.config = {
    date_suffix: {
      just: '刚刚',
      min: '分钟前',
      hour: '小时前',
      day: '天前',
      month: '个月前',
    },
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://gcore.jsdelivr.net/npm/jquery@3.6.2/dist/jquery.min.js'
  };

  if ('local_search') {
    stellar.search = {};
    stellar.search.service = 'local_search';
    if (stellar.search.service == 'local_search') {
      let service_obj = Object.assign({}, {"field":"all","path":"/search.json","content":true,"sort":"-date"});
      stellar.search[stellar.search.service] = service_obj;
    }
  }

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js","weibo":"/js/plugins/weibo.js"});

  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");
  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/vanilla-lazyload@17.8.3/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.css","js":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://gcore.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti@0.9.2/umd/heti.min.css","js":"https://unpkg.com/heti@0.9.2/umd/heti-addon.min.js"});
  }
</script>

<!-- required -->

  
<script src="/re4mile/js/main.js" async></script>



<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        stellar.loadScript('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://twik00.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<!-- inject -->


  </div>
</body>
</html>
