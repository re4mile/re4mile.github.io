<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="https://s1.ax1x.com/2023/01/03/pSip2aF.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://s1.ax1x.com/2023/01/03/pSip2aF.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://s1.ax1x.com/2023/01/03/pSip2aF.png">
  <link rel="mask-icon" href="https://s1.ax1x.com/2023/01/03/pSip2aF.png" color="#222">

<link rel="stylesheet" href="/re4mile.github.io/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/re4mile.github.io/","images":"/re4mile.github.io/images","scheme":"Pisces","darkmode":true,"version":"8.14.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/re4mile.github.io/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/re4mile.github.io/js/config.js"></script>

    <meta name="description" content="结构体1234typedef struct _CONSOLE_CURSOR_INFO &amp;#123;    DWORD  dwSize;&#x2F;&#x2F;光标大小所占一个字符的百分比    BOOL   bVisible; &#x2F;&#x2F;光标是否可见&amp;#125; CONSOLE_CURSOR_INFO, *PCONSOLE_CURSOR_INFO;    函数进程相关WaitForDebugEvent1234567BOOL">
<meta property="og:type" content="article">
<meta property="og:title" content="win32 API积累">
<meta property="og:url" content="https://github.com/re4mile/re4mile.github.io.git/2023/01/11/language/C/win32/%E5%B0%8F%E4%B8%93%E9%A2%98/%E9%81%87%E5%88%B0%E7%9A%84API/language/index.html">
<meta property="og:site_name" content="实践是检验真理的唯一标准">
<meta property="og:description" content="结构体1234typedef struct _CONSOLE_CURSOR_INFO &amp;#123;    DWORD  dwSize;&#x2F;&#x2F;光标大小所占一个字符的百分比    BOOL   bVisible; &#x2F;&#x2F;光标是否可见&amp;#125; CONSOLE_CURSOR_INFO, *PCONSOLE_CURSOR_INFO;    函数进程相关WaitForDebugEvent1234567BOOL">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-01-11T14:41:23.060Z">
<meta property="article:modified_time" content="2023-01-11T13:01:30.393Z">
<meta property="article:author" content="re4mile(邓渠香)">
<meta property="article:tag" content="Win32">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://github.com/re4mile/re4mile.github.io.git/2023/01/11/language/C/win32/%E5%B0%8F%E4%B8%93%E9%A2%98/%E9%81%87%E5%88%B0%E7%9A%84API/language/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://github.com/re4mile/re4mile.github.io.git/2023/01/11/language/C/win32/%E5%B0%8F%E4%B8%93%E9%A2%98/%E9%81%87%E5%88%B0%E7%9A%84API/language/","path":"2023/01/11/language/C/win32/小专题/遇到的API/language/","title":"win32 API积累"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>win32 API积累 | 实践是检验真理的唯一标准</title>
  








  <noscript>
    <link rel="stylesheet" href="/re4mile.github.io/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/re4mile.github.io/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">实践是检验真理的唯一标准</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">好记性不如烂笔头</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/re4mile.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/re4mile.github.io/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/re4mile.github.io/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/re4mile.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-number">1.</span> <span class="nav-text">结构体</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">2.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E7%9B%B8%E5%85%B3"><span class="nav-number">2.1.</span> <span class="nav-text">进程相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WaitForDebugEvent"><span class="nav-number">2.1.1.</span> <span class="nav-text">WaitForDebugEvent</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3"><span class="nav-number">2.2.</span> <span class="nav-text">线程相关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AA%97%E5%8F%A3%E7%9B%B8%E5%85%B3"><span class="nav-number">2.3.</span> <span class="nav-text">窗口相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Messagebox"><span class="nav-number">2.3.1.</span> <span class="nav-text">Messagebox</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E5%88%86%E9%85%8D%E7%9B%B8%E5%85%B3"><span class="nav-number">2.4.</span> <span class="nav-text">资源分配相关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E7%9B%B8%E5%85%B3"><span class="nav-number">2.5.</span> <span class="nav-text">调试相关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AA%E5%88%86%E7%B1%BB"><span class="nav-number">2.6.</span> <span class="nav-text">未分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AdjustTokenPrivileges-%E7%89%B9%E6%9D%83%E8%AE%BE%E7%BD%AE"><span class="nav-number">2.6.1.</span> <span class="nav-text">AdjustTokenPrivileges 特权设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CopyFile"><span class="nav-number">2.6.2.</span> <span class="nav-text">CopyFile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CallNextHookEx"><span class="nav-number">2.6.3.</span> <span class="nav-text">CallNextHookEx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ContinueDebugEvent"><span class="nav-number">2.6.4.</span> <span class="nav-text">ContinueDebugEvent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DebugActiveProcess"><span class="nav-number">2.6.5.</span> <span class="nav-text">DebugActiveProcess</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GetSystemDirectory"><span class="nav-number">2.6.6.</span> <span class="nav-text">GetSystemDirectory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GlobalAlloc-%E5%85%A8%E5%B1%80%E5%A0%86%E5%88%86%E9%85%8D"><span class="nav-number">2.6.7.</span> <span class="nav-text">GlobalAlloc 全局堆分配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Globallock"><span class="nav-number">2.6.8.</span> <span class="nav-text">Globallock</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#InternetOpenA"><span class="nav-number">2.6.9.</span> <span class="nav-text">InternetOpenA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#InternetOpenUrl"><span class="nav-number">2.6.10.</span> <span class="nav-text">InternetOpenUrl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#InternetReadFile-%E6%89%93%E5%BC%80%E7%9A%84%E5%8F%A5%E6%9F%84%E4%B8%AD%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E3%80%82"><span class="nav-number">2.6.11.</span> <span class="nav-text">InternetReadFile 打开的句柄中读取数据。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#KeyboardProc"><span class="nav-number">2.6.12.</span> <span class="nav-text">KeyboardProc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lstrcat"><span class="nav-number">2.6.13.</span> <span class="nav-text">lstrcat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LookupPrivilegeValueA"><span class="nav-number">2.6.14.</span> <span class="nav-text">LookupPrivilegeValueA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UnhookWindowsHookEx"><span class="nav-number">2.6.15.</span> <span class="nav-text">UnhookWindowsHookEx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OutputDebugString"><span class="nav-number">2.6.16.</span> <span class="nav-text">OutputDebugString</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OpenProcessToken-%E4%BB%A5%E6%9F%90%E7%A7%8D%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E6%89%93%E5%BC%80%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B"><span class="nav-number">2.6.17.</span> <span class="nav-text">OpenProcessToken 以某种访问权限打开一个进程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ShellExecute-Dev%E7%8E%AF%E5%A2%83"><span class="nav-number">2.6.18.</span> <span class="nav-text">ShellExecute -Dev环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SetWindowsHookExW-%E9%92%A9%E5%8F%96%E6%B5%81%E7%A8%8B"><span class="nav-number">2.6.19.</span> <span class="nav-text">SetWindowsHookExW - 钩取流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TOKEN-PRIVILEGES"><span class="nav-number">2.6.20.</span> <span class="nav-text">TOKEN_PRIVILEGES</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URLDownloadToFile"><span class="nav-number">2.6.21.</span> <span class="nav-text">URLDownloadToFile</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%97%E8%8A%82%E8%BD%AC%E5%8C%96"><span class="nav-number">3.</span> <span class="nav-text">字节转化</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="re4mile(邓渠香)"
      src="https://s1.ax1x.com/2023/01/10/pSefBp6.jpg">
  <p class="site-author-name" itemprop="name">re4mile(邓渠香)</p>
  <div class="site-description" itemprop="description">an ordinary people</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/re4mile.github.io/archives/">
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/re4mile.github.io/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/re4mile.github.io/tags/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://re4mile.gitee.io/" title="Gitee → https:&#x2F;&#x2F;re4mile.gitee.io" rel="noopener me" target="_blank"><i class="fa fa-subway fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/re4mile/" title="cnblog → https:&#x2F;&#x2F;www.cnblogs.com&#x2F;re4mile&#x2F;" rel="noopener me" target="_blank"><i class="fa fa-space-shuttle fa-fw"></i>cnblog</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/re4mile/re4mile.github.io.git/2023/01/11/language/C/win32/%E5%B0%8F%E4%B8%93%E9%A2%98/%E9%81%87%E5%88%B0%E7%9A%84API/language/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s1.ax1x.com/2023/01/10/pSefBp6.jpg">
      <meta itemprop="name" content="re4mile(邓渠香)">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="实践是检验真理的唯一标准">
      <meta itemprop="description" content="an ordinary people">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="win32 API积累 | 实践是检验真理的唯一标准">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          win32 API积累
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-01-11 22:41:23 / 修改时间：21:01:30" itemprop="dateCreated datePublished" datetime="2023-01-11T22:41:23+08:00">2023-01-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/re4mile.github.io/categories/Language/" itemprop="url" rel="index"><span itemprop="name">Language</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">CONSOLE_CURSOR_INFO</span> &#123;</span></span><br><span class="line">    DWORD  dwSize;<span class="comment">//光标大小所占一个字符的百分比</span></span><br><span class="line">    BOOL   bVisible; <span class="comment">//光标是否可见</span></span><br><span class="line">&#125; CONSOLE_CURSOR_INFO, *PCONSOLE_CURSOR_INFO;</span><br></pre></td></tr></table></figure>



<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="进程相关"><a href="#进程相关" class="headerlink" title="进程相关"></a>进程相关</h2><h3 id="WaitForDebugEvent"><a href="#WaitForDebugEvent" class="headerlink" title="WaitForDebugEvent"></a>WaitForDebugEvent</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BOOL <span class="title function_">WaitForDebugEvent</span><span class="params">(</span></span><br><span class="line"><span class="params">  [out] LPDEBUG_EVENT lpDebugEvent, </span></span><br><span class="line"><span class="params">    <span class="comment">//指向接收调试事件信息的 DEBUG_EVENT 结构的指针。</span></span></span><br><span class="line"><span class="params">  [in]  DWORD         dwMilliseconds </span></span><br><span class="line"><span class="params">    <span class="comment">//等待调试事件的毫秒数。 如果此参数为零，则函数会测试调试事件并立即返回。 </span></span></span><br><span class="line"><span class="params">    <span class="comment">//如果参数为 INFINITE，则在调试事件发生之前，该函数不会返回。</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>

<p>如果该函数成功，则返回值为非零值。</p>
<p>如果函数失败，则返回值为零。 要获得更多的错误信息，请调用 GetLastError。</p>
<h2 id="线程相关"><a href="#线程相关" class="headerlink" title="线程相关"></a>线程相关</h2><h2 id="窗口相关"><a href="#窗口相关" class="headerlink" title="窗口相关"></a>窗口相关</h2><h3 id="Messagebox"><a href="#Messagebox" class="headerlink" title="Messagebox"></a>Messagebox</h3><p>   MB_ABORTRETRYIGNORE：消息框含有三个按钮：Abort，Retry和Ignore。</p>
<p>　　MB_OK：消息框含有一个按钮：OK。这是缺省值。</p>
<p>　　MB_OKCANCEL：消息框含有两个按钮：OK和Cancel。</p>
<p>　　MB_RETRYCANCEL：消息框含有两个按钮：Retry和Cancel。</p>
<p>　　MB_YESNO：消息框含有两个按钮：Yes和No。</p>
<p>　　MB_YESNOCANCEL：消息框含有三个按钮：Yes，No和Cancel。</p>
<p>　　指定下列标志中的一个来显示消息框中的图标：标志的含义如下。</p>
<p>　　MB_ICONWARNING：一个惊叹号出现在消息框。</p>
<p>　　MB_ICONASTERISK：一个圆圈中小写字母i组成的图标出现在消息框。</p>
<p>返回值</p>
<p>如果没有足够的内存来创建消息框，则返回值为零。如果函数调用成功，则返回值为下列对话框返回的菜单项目值中的一个：</p>
<p>　　IDABORT：Abort 按钮被选中。IDCANCEL：Cancel按钮被选中。IDIGNORE：Ignore按钮被选中。</p>
<p>　　IDNO：NO按钮被选中。IDOK：OK按钮被选中。IDRETRY：RETRY按钮被选中。</p>
<p>　　IDYES：YES按钮被选中。</p>
<p>　　如果一个消息框有一个Cancel按钮，且如果Esc键被按下或Cancel键被选择，则函数返回IDCANCEL值。如果消息框没有Cancel按钮，则按Esc键没有作用。</p>
<p>　</p>
<h2 id="资源分配相关"><a href="#资源分配相关" class="headerlink" title="资源分配相关"></a>资源分配相关</h2><h2 id="调试相关"><a href="#调试相关" class="headerlink" title="调试相关"></a>调试相关</h2><h2 id="未分类"><a href="#未分类" class="headerlink" title="未分类"></a>未分类</h2><p>  __in_opt  LPSECURITY_ATTRIBUTES lpMutexAttributes, &#x2F;&#x2F;安全属性,垃圾,NULL	</p>
<p>如果API有这种参数的话,就说明他是与内核对象相关的函数</p>
<h3 id="AdjustTokenPrivileges-特权设置"><a href="#AdjustTokenPrivileges-特权设置" class="headerlink" title="AdjustTokenPrivileges 特权设置"></a>AdjustTokenPrivileges 特权设置</h3><p>用于启用或禁止，指定访问令牌的特权</p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/366969">https://developer.aliyun.com/article/366969</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">AdjustTokenPrivileges</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            HANDLE            TokenHandle, 	<span class="comment">//包含要修改de特权的句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            BOOL              DisableAllPrivileges, <span class="comment">//是否禁用所有令牌的权限</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional]  PTOKEN_PRIVILEGES NewState, 		<span class="comment">//新特权信息的指针,指定了一组特权和他们的属性.</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            DWORD             BufferLength, 	<span class="comment">//指向的缓冲区的大小</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [out, optional] PTOKEN_PRIVILEGES PreviousState, 	<span class="comment">//接收被改变特权当前状态的Buffer,他和都3个参数的类型一样的</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [out, optional] PDWORD            ReturnLength 	<span class="comment">//接收PreviousState缓存区要求的大小</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>AdjustTokenPrivileges</strong>函数无法向访问令牌添加新权限。它只能启用或禁用令牌的现有权限。要确定令牌的权限，请调用 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/securitybaseapi/nf-securitybaseapi-gettokeninformation">GetTokenInformation</a>函数。</p>
<p>返回值<br>如果函数成功，则返回值非零。要确定函数是否调整了所有指定的权限，请调用 GetLastError，它会在函数成功时返回以下值之一：<br>令牌不具有在NewState参数中指定的一项或多项特权。即使没有调整权限，该函数也可能会成功并出现此错误值。PreviousState参数表示已调整的权限 。</p>
<p>如果函数失败，则返回值为零。要获取扩展的错误信息，请调用GetLastError。</p>
<h3 id="CopyFile"><a href="#CopyFile" class="headerlink" title="CopyFile"></a>CopyFile</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BOOL <span class="title function_">CopyFile</span><span class="params">(</span></span><br><span class="line"><span class="params">  [in] LPCTSTR lpExistingFileName, <span class="comment">//S</span></span></span><br><span class="line"><span class="params">  [in] LPCTSTR lpNewFileName, <span class="comment">//D</span></span></span><br><span class="line"><span class="params">  [in] BOOL    bFailIfExists</span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>



<p>最后一个参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[in] bFailIfExists</span><br></pre></td></tr></table></figure>

<p>如果此参数为<strong>TRUE</strong>,原文存在,则函数失败</p>
<p>如果此参数为 <strong>FALSE</strong>,源文件不存在,于是就覆盖</p>
<p>返回值</p>
<p>如果函数成功，则返回值非零。<br>如果函数失败，则返回值为零。要获取扩展的错误信息，请调用 GetLastError。</p>
<h3 id="CallNextHookEx"><a href="#CallNextHookEx" class="headerlink" title="CallNextHookEx"></a>CallNextHookEx</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT <span class="title">CallNextHookEx</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    HHOOK  hhk, <span class="comment">//该参数被忽略。</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span>    nCode,</span></span></span><br><span class="line"><span class="params"><span class="function">    WPARAM wParam,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPARAM lParam</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>



<p>ncode</p>
<p>传递给当前钩子过程的钩子代码。下一个钩子过程使用此代码来确定如何处理钩子信息。</p>
<p>类型：<strong>WPARAM</strong></p>
<p>传递给当前挂钩过程的<em>wParam值。</em>该参数的含义取决于与当前钩子链关联的钩子类型 </p>
<p>类型：<strong>LPARAM</strong></p>
<p>传递给当前挂钩过程的<em>lParam值。</em>该参数的含义取决于与当前钩子链关联的钩子类型。</p>
<p>正确的消息处理流程应该如下</p>
<p>　　物理击键</p>
<p>　　　↓</p>
<p>　　钩子管理函数←→钩子A←→钩子B←→钩子C←→钩子D</p>
<p>　　　↓</p>
<p>　　Window消息处理函数</p>
<p>在钩子A函数中，如果调用CallNextHookEx函数，则会将按键消息传给钩子B；</p>
<p>如果不调用CallNextHookEx函数，则钩子B不会得到按键消息，换句话说，钩子B失效了，当然此时的钩子C和钩子D也失效了。为了钩子间和平相处，还是应该在钩子函数里添加CallNextHookEx函数的调用。</p>
<p>钩子函数的返回值的问题。在上面的事例中，钩子A的返回值决定按键消息是否丢弃。</p>
<p>返回值0，告诉系统，消息继续传递给Window消息处理函数；</p>
<p>返回值1（非0），告诉系统，消息将丢弃，Window消息处理函数得不到按键的消息。</p>
<h3 id="ContinueDebugEvent"><a href="#ContinueDebugEvent" class="headerlink" title="ContinueDebugEvent"></a>ContinueDebugEvent</h3><p>使调试器能够继续先前报告调试事件的线程。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">ContinueDebugEvent</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] DWORD dwProcessId,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] DWORD dwThreadId,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] DWORD dwContinueStatus</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>







<h3 id="DebugActiveProcess"><a href="#DebugActiveProcess" class="headerlink" title="DebugActiveProcess"></a>DebugActiveProcess</h3><p>使调试器附加到一个活动进程并且调试它。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">DebugActiveProcess</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] DWORD dwProcessId</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p>如果函数成功，则返回值非零。</p>
<p>如果函数失败，则返回值为 0（零）。要获取扩展的错误信息，请调用 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror">GetLastError</a></p>
<h3 id="GetSystemDirectory"><a href="#GetSystemDirectory" class="headerlink" title="GetSystemDirectory"></a>GetSystemDirectory</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UINT <span class="title function_">GetSystemDirectoryA</span><span class="params">(</span></span><br><span class="line"><span class="params">  [out] LPSTR lpBuffer,<span class="comment">//用于装载系统目录路径名的一个字串缓冲区</span></span></span><br><span class="line"><span class="params">  [in]  UINT  uSize<span class="comment">//字串的最大长度</span></span></span><br><span class="line"><span class="params">)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="GlobalAlloc-全局堆分配"><a href="#GlobalAlloc-全局堆分配" class="headerlink" title="GlobalAlloc 全局堆分配"></a>GlobalAlloc 全局堆分配</h3><p>该函数从堆中分配一定数目的字节数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">DECLSPEC_ALLOCATOR HGLOBAL <span class="title">GlobalAlloc</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] UINT   uFlags, <span class="comment">//  分配属性(方式)</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in] SIZE_T dwBytes <span class="comment">// 分配的字节数</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>





<p>返回值</p>
<p>若函数调用成功,则返回一个新分配的内存对象的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8F%A5%E6%9F%84">句柄</a>。</p>
<p>若函数调用失败,则返回<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/NULL">NULL</a>。可调用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/GetLastError">GetLastError</a>以获得更多错误信息。</p>
<p>若<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8">函数调用</a>成功,将至少分配所需内存.若实际分配量超过所需,则内存仍然能够充分利用之.可用函数 GlobalSize 来确定实际所分配的字节数。</p>
<p>可使用 GlobalFree 来释放内存。</p>
<h3 id="Globallock"><a href="#Globallock" class="headerlink" title="Globallock"></a>Globallock</h3><p>锁定内存中指定的内存块，并返回一个地址值，令其指向内存块的起始处。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LPVOID <span class="title">GlobalLock</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] HGLOBAL hMem</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>

<p>除非用 GlobalUnlock 函数将内存块解锁，否则地址会一直保持有效</p>
<p>参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[in] hMem</span><br></pre></td></tr></table></figure>

<p>全局内存对象的句柄。此句柄由 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-globalalloc">GlobalAlloc</a>或 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-globalrealloc">GlobalReAlloc</a>函数返回</p>
<p>返回值</p>
<p>如果函数成功，则返回值是指向内存块第一个字节的指针。</p>
<p>如果函数失败，则返回值为<strong>NULL</strong>。</p>
<ol start="4">
<li></li>
</ol>
<h3 id="InternetOpenA"><a href="#InternetOpenA" class="headerlink" title="InternetOpenA"></a>InternetOpenA</h3><p> 初始化应用程序对 WinINet 函数的使用</p>
<p>该函数是第一个由应用程序调用的 WinINet 函数。它告诉 Internet DLL 初始化内部数据结构并准备接收应用程序之后的其他调用。当应用程序结束使用 Internet 函数时，应调用 InternetCloseHandle 函数来释放与之相关的资源。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HINTERNET <span class="title">InternetOpenA</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] LPCSTR lpszAgent, <span class="comment">//exe调用WinINet函数的应用程序或入口</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in] DWORD  dwAccessType, <span class="comment">//指定访问类型</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in] LPCSTR lpszProxy, <span class="comment">//指定一个可选的主机名列表或IP地址</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in] LPCSTR lpszProxyBypass,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] DWORD  dwFlags</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>

<p>返回值</p>
<p>成功：返回一个有效的句柄，该句柄将由应用程序传递给接下来的WinINet函数。</p>
<p>失败：返回NULL。	</p>
<h3 id="InternetOpenUrl"><a href="#InternetOpenUrl" class="headerlink" title="InternetOpenUrl"></a>InternetOpenUrl</h3><p>打开由完整的 FTP 或 HTTP URL 指定的资源</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HINTERNET <span class="title">InternetOpenUrlA</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] HINTERNET hInternet, <span class="comment">//会话句柄,由InternetOpen 调用返回</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in] LPCSTR    lpszUrl, <span class="comment">//指定读取的网址</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in] LPCSTR    lpszHeaders, <span class="comment">//指定发送到HTTP服务器的头信息</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in] DWORD     dwHeadersLength,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] DWORD     dwFlags,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in] DWORD_PTR dwContext</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>

<p>返回值</p>
<p>如果连接成功建立，则返回 URL 的有效句柄；如果连接失败，则返回<strong>NULL 。</strong>要检索特定错误消息，请调用 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror">GetLastError</a>。要确定拒绝访问服务的原因，请调用 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/wininet/nf-wininet-internetgetlastresponseinfoa">InternetGetLastResponseInfo</a>。</p>
<h3 id="InternetReadFile-打开的句柄中读取数据。"><a href="#InternetReadFile-打开的句柄中读取数据。" class="headerlink" title="InternetReadFile 打开的句柄中读取数据。"></a>InternetReadFile 打开的句柄中读取数据。</h3><p>打开的句柄中读取数据。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">InternetReadFile</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]  HINTERNET hFile,</span></span></span><br><span class="line"><span class="params"><span class="function">  [out] LPVOID    lpBuffer, <span class="comment">//缓冲器指针</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]  DWORD     dwNumberOfBytesToRead, <span class="comment">///欲读数据的字节量</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [out] LPDWORD   lpdwNumberOfBytesRead <span class="comment">//接收读取字节量的变量s</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[in] hFile</span><br></pre></td></tr></table></figure>

<p>从先前调用 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/wininet/nf-wininet-internetopenurla">InternetOpenUrl</a>、 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/wininet/nf-wininet-ftpopenfilea">FtpOpenFile</a>或 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/wininet/nf-wininet-httpopenrequesta">HttpOpenRequest</a>返回的句柄。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[out] lpBuffer</span><br></pre></td></tr></table></figure>

<p>指向接收数据的缓冲区的指针。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[in] dwNumberOfBytesToRead</span><br></pre></td></tr></table></figure>

<p>要读取的字节数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[out] lpdwNumberOfBytesRead</span><br></pre></td></tr></table></figure>

<p>指向接收读取字节数的变量的指针。 <strong>InternetReadFile</strong>在进行任何工作或错误检查之前将此值设置为零。</p>
<p> 返回值</p>
<p>如果成功则返回<strong>TRUE ，否则返回****FALSE</strong>。要获取扩展的错误信息，请调用 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror">GetLastError</a>。</p>
<h3 id="KeyboardProc"><a href="#KeyboardProc" class="headerlink" title="KeyboardProc"></a>KeyboardProc</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LRESULT CALLBACK KeyboardProc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> code,</span><br><span class="line">    WPARAM wParam,</span><br><span class="line">    LPARAM lParam</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>nCode: 根据这个数值决定怎样处理消息</p>
<p>​			如果 code 小于0，则 必须让KeyboardProc()函数返回CallNextHookEx()</p>
<p>​			code可以是下列值：</p>
<p>​			HC_ACTION：wParam和lParam包含按键消息</p>
<p>​			HC_NOREMOVE：wParam和lParam包含按键消息,并且按键消息不能从<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97">消息队列</a>中移除（一个被PeekMessage<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8">函数调用</a>的请求，指定   			PM_NOREMOVE标志）</p>
<p>wParam: 按键的虚拟键值消息，例如:VK_F1</p>
<p>lParam: 根据不同的位数具有多种不同的含义</p>
<p>LRESULT是一个数据类型，指的是从窗口程序或者回调函数返回的32位值。</p>
<p>CALLBACK是由用户设计却由windows系统呼叫的函数，统称为callback函数。某些API函数要求以callback作为你参数之一。</p>
<h3 id="lstrcat"><a href="#lstrcat" class="headerlink" title="lstrcat"></a>lstrcat</h3><p>字符串衔接</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LPSTR <span class="title function_">lstrcat</span><span class="params">(</span></span><br><span class="line"><span class="params">  [in, out] LPSTR  lpString1, <span class="comment">//S</span></span></span><br><span class="line"><span class="params">  [in]      LPCSTR lpString2 <span class="comment">//D</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[in, out] lpString1</span><br></pre></td></tr></table></figure>

<p>类型：<strong>LPTSTR</strong></p>
<p>第一个以 null 结尾的字符串。此缓冲区必须足够大以包含两个字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[in] lpString2</span><br></pre></td></tr></table></figure>

<p>类型：<strong>LPTSTR</strong></p>
<p>要附加到<em>lpString1</em>参数中指定的字符串的空终止字符串。</p>
<p>返回值</p>
<p>如果函数成功，则返回值是指向缓冲区的指针。</p>
<p>如果函数失败，则返回值为<strong>NULL</strong> ，并且<em>lpString1</em>可能不是以 null 结尾的。</p>
<h3 id="LookupPrivilegeValueA"><a href="#LookupPrivilegeValueA" class="headerlink" title="LookupPrivilegeValueA"></a>LookupPrivilegeValueA</h3><p>函数查看系统权限的特权值，返回信息到一个LUID结构体里</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BOOL <span class="title function_">LookupPrivilegeValueA</span><span class="params">(</span></span><br><span class="line"><span class="params">  [in, optional] LPCSTR lpSystemName, <span class="comment">//表示所要查看的系统，本地系统直接用NULL</span></span></span><br><span class="line"><span class="params">  [in]           LPCSTR lpName, <span class="comment">//指定特权的名称</span></span></span><br><span class="line"><span class="params">  [out]          PLUID  lpLuid <span class="comment">//接收所返回的制定特权名称的信息接收所返回的制定特权名称的信息</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>



<p>一个指向变量的指针，该变量接收由<em>lpSystemName</em>参数指定的系统上的权限已知的 LUID。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_LUID</span> &#123;</span><br><span class="line">    DWORD LowPart;</span><br><span class="line">    LONG HighPart;</span><br><span class="line">&#125; LUID, *PLUID;</span><br></pre></td></tr></table></figure>



<p>返回值</p>
<p>函数调用成功后，信息存入第三个类型为LUID的结构体中，并且函数返回非0</p>
<h3 id="UnhookWindowsHookEx"><a href="#UnhookWindowsHookEx" class="headerlink" title="UnhookWindowsHookEx"></a>UnhookWindowsHookEx</h3><p>通过UnhookWindowsHookEx函数删除安装在挂钩链中的挂钩过程</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BOOL <span class="title function_">UnhookWindowsHookEx</span><span class="params">(</span></span><br><span class="line"><span class="params">   HHOOK hhk</span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>

<p>类型：<strong>HHOOK</strong></p>
<p>要移除的挂钩的handle。此参数是通过先前调用SetWindowsHookEx获得的挂钩句柄。</p>
<p>返回值</p>
<p>如果函数成功，则返回值非零。</p>
<p>如果函数失败，则返回值为零。</p>
<h3 id="OutputDebugString"><a href="#OutputDebugString" class="headerlink" title="OutputDebugString"></a>OutputDebugString</h3><p>类似于printf,将字符串发送到调试器进行显示。</p>
<h3 id="OpenProcessToken-以某种访问权限打开一个进程"><a href="#OpenProcessToken-以某种访问权限打开一个进程" class="headerlink" title="OpenProcessToken 以某种访问权限打开一个进程"></a>OpenProcessToken 以某种访问权限打开一个进程</h3><p>用来打开与进程相关联的访问令牌</p>
<p>OpenProcessToken函数用来打开与进程相关联的访问令牌</p>
<p><code>得到指定进程的访问令牌，而第三个参数定义设置不正确可能导致该函数调用失败</code></p>
<p>要对一个任意进程（包括系统安全进程和服务进程）进行指定了写相关的访问权的OpenProcess操作，只要当前进程具有<code>SeDeDebug</code>权限就可以了。要是一个用户是Administrator或是被给予了相应的权限，就可以具有该权限。</p>
<p>可是，就算我们用Administrator帐号对一个系统安全进程执行OpenProcess(PROCESS_ALL_ACCESS,FALSE, dwProcessID)还是会遇到“访问拒绝”的错误。什么原因呢？原来在<code>默认的情况下进程的一些访问权限是没有被启用（Enabled）</code>的，所以我们要做的首先是启用这些权限。</p>
<p>《WINDOWS核心编程》!</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/stonesharp/article/details/7709674">https://blog.csdn.net/stonesharp/article/details/7709674</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">OpenProcessToken</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]  HANDLE  ProcessHandle,<span class="comment">//要修改访问权限的进程句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]  DWORD   DesiredAccess, <span class="comment">//你要进行的操作类型</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [out] PHANDLE TokenHandle 	<span class="comment">//返回的访问令牌指针</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>



<p>如果函数成功，则返回值非零。</p>
<p>如果函数失败，则返回值为零</p>
<h3 id="ShellExecute-Dev环境"><a href="#ShellExecute-Dev环境" class="headerlink" title="ShellExecute -Dev环境"></a>ShellExecute -Dev环境</h3><p>对指定文件执行操作。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HINSTANCE <span class="title">ShellExecuteA</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional] HWND   hwnd,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional] LPCSTR lpOperation,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           LPCSTR lpFile,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional] LPCSTR lpParameters,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional] LPCSTR lpDirectory,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]           INT    nShowCmd</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>

<p>参数2</p>
<p>这个参数可以是<code>&quot;edit&quot;</code> <code>&quot;explore&quot;</code> <code>&quot;open&quot;</code> <code>&quot;print&quot;</code> <code>&quot;runas&quot;</code> <code>NULL</code>，分别可以打开编辑器、在文件资源管理器中查看、打开、屏幕输出和 <strong>以管理员身份运行</strong> 。</p>
<p>最后一个参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SW_HIDE 隐藏窗口，活动状态给令一个窗口 </span><br><span class="line"></span><br><span class="line">SW_MINIMIZE 最小化窗口，活动状态给令一个窗口 </span><br><span class="line"></span><br><span class="line">SW_RESTORE 用原来的大小和位置显示一个窗口，同时令其进入活动状态 </span><br><span class="line"></span><br><span class="line">SW_SHOW 用当前的大小和位置显示一个窗口，同时令其进入活动状态 </span><br><span class="line"></span><br><span class="line">SW_SHOWMAXIMIZED 最大化窗口，并将其激活 </span><br><span class="line"></span><br><span class="line">SW_SHOWMINIMIZED 最小化窗口，并将其激活 </span><br><span class="line"></span><br><span class="line">SW_SHOWMINNOACTIVE 最小化一个窗口，同时不改变活动窗口 </span><br><span class="line"></span><br><span class="line">SW_SHOWNA 用当前的大小和位置显示一个窗口，不改变活动窗口 </span><br><span class="line"></span><br><span class="line">SW_SHOWNOACTIVATE 用最近的大小和位置显示一个窗口，同时不改变活动窗口 </span><br><span class="line"></span><br><span class="line">SW_SHOWNORMAL 与SW_RESTORE相同 </span><br></pre></td></tr></table></figure>



<p>返回值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">返回值大于32表示执行成功</span><br><span class="line">返回值小于32表示执行错误</span><br><span class="line">返回值可能的错误有: = 0 &#123;内存不足&#125;</span><br><span class="line">ERROR_FILE_NOT_FOUND = 2; &#123;文件名错误&#125;</span><br><span class="line">ERROR_PATH_NOT_FOUND = 3; &#123;路径名错误&#125;</span><br><span class="line">ERROR_BAD_FORMAT = 11; &#123;EXE 文件无效&#125;</span><br><span class="line">SE_ERR_SHARE = 26; &#123;发生共享错误&#125;</span><br><span class="line">SE_ERR_ASSOCINCOMPLETE = 27; &#123;文件名不完全或无效&#125;</span><br><span class="line">SE_ERR_DDETIMEOUT = 28; &#123;超时&#125;</span><br><span class="line">SE_ERR_DDEFAIL = 29; &#123;DDE 事务失败&#125;</span><br><span class="line">SE_ERR_DDEBUSY = 30; &#123;正在处理其他 DDE 事务而不能完成该 DDE 事务&#125;</span><br><span class="line">SE_ERR_NOASSOC = 31; &#123;没有相关联的应用程序&#125;</span><br></pre></td></tr></table></figure>



<p>开始一个新的应用程序 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ShellExecute(NULL, &quot;open&quot;, &quot;notepad.exe&quot;, NULL, NULL, SW_SHOWNORMAL); </span><br></pre></td></tr></table></figure>

<p>打开记事本，并打开一个文件(系统能识别记事本应用程序的路径，因此我们不必使用绝对路径） </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res=ShellExecute(NULL, &quot;open&quot;, &quot;notepad.exe&quot;, &quot;C:\\Users\\0x9D\\Desktop\\Test\\Work_Now.cpp&quot;, NULL, SW_SHOWNORMAL);</span><br></pre></td></tr></table></figure>

<p>打印一个文档 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ShellExecute(Handle, &#x27;print&#x27;, PChar(&#x27;c:/test/test.doc&#x27;), nil, nil, SW_SHOW); </span><br></pre></td></tr></table></figure>

<p>注意：可能你会看到word暂时的被打开，但它会自动关闭。 </p>
<p>打开一个HTML页面 </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ShellExecute</span>(<span class="literal">NULL</span>, <span class="string">&quot;open&quot;</span>, <span class="string">&quot;http://wus20.com&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, SW_SHOW);</span><br><span class="line"><span class="built_in">ShellExecute</span>(<span class="literal">NULL</span>, <span class="string">&quot;open&quot;</span>, <span class="string">&quot;C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe&quot;</span>, <span class="string">&quot;bilibili.com&quot;</span>, <span class="literal">NULL</span>, SW_SHOWNORMAL);</span><br></pre></td></tr></table></figure>

<p>你能通过一个已经注册的文件类型来打开应用程序 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　　ShellExecute(Handle, &#x27;open&#x27;, PChar(&#x27;c:/test/readme.txt&#x27;), nil, nil, SW_SHOW); </span><br></pre></td></tr></table></figure>

<p>用windows Explorer 打开一个目录 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　ShellExecute(Handle, &#x27;explore&#x27;, PChar(&#x27;c:/windows)&#x27;, nil, nil, SW_SHOW); </span><br></pre></td></tr></table></figure>

<p>运行一个DOS命令并立即返回 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　　ShellExecute(Handle, &#x27;open&#x27;, PChar(&#x27;command.com&#x27;), PChar(&#x27;/c copy file1.txt file2.txt&#x27;), nil, SW_SHOW); </span><br></pre></td></tr></table></figure>

<p>运行一个DOS命令并保持DOS窗口存在 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res=ShellExecute(NULL, &quot;open&quot;, &quot;cmd&quot;, &quot;/k dir&quot;, NULL, SW_SHOW); </span><br></pre></td></tr></table></figure>



<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	SHELLEXECUTEINFO dqx = &#123; <span class="built_in">sizeof</span>(SHELLEXECUTEINFO) &#125;;</span><br><span class="line">	dqx.lpVerb = <span class="built_in">TEXT</span>(<span class="string">&quot;runas&quot;</span>);</span><br><span class="line">	dqx.lpFile = <span class="built_in">TEXT</span>(<span class="string">&quot;cmd.exe&quot;</span>);</span><br><span class="line">	dqx.nShow = SW_SHOWNORMAL;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">ShellExecuteEx</span>(&amp;dqx))</span><br><span class="line">	&#123;</span><br><span class="line">		DWORD dwStatus = <span class="built_in">GetLastError</span>();</span><br><span class="line">		<span class="keyword">if</span> (dwStatus == ERROR_CANCELLED)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;提升权限被用户拒绝\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (dwStatus == ERROR_FILE_NOT_FOUND)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;所要执行的文件没有找到\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">system</span>(<span class="string">&quot;pause nul&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>建立一个网页</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HINSTANCE ret=<span class="number">0</span>;</span><br><span class="line">	ret=<span class="built_in">ShellExecute</span>(<span class="literal">NULL</span>, <span class="string">&quot;open&quot;</span>, <span class="string">&quot;http://wus20.com&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, SW_SHOW);</span><br><span class="line">	<span class="keyword">if</span>(ret&lt;(HINSTANCE)<span class="number">32</span>)</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsProcessRunAsAdmin</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SID_IDENTIFIER_AUTHORITY NtAuthority = SECURITY_NT_AUTHORITY;</span><br><span class="line">    PSID AdministratorsGroup;</span><br><span class="line">    BOOL b = <span class="built_in">AllocateAndInitializeSid</span>(</span><br><span class="line">        &amp;NtAuthority,</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        SECURITY_BUILTIN_DOMAIN_RID,</span><br><span class="line">        DOMAIN_ALIAS_RID_ADMINS,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">        &amp;AdministratorsGroup);</span><br><span class="line">    <span class="keyword">if</span>(b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">CheckTokenMembership</span>(<span class="literal">NULL</span>, AdministratorsGroup, &amp;b);</span><br><span class="line">        <span class="built_in">FreeSid</span>(AdministratorsGroup);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b == TRUE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">short</span> <span class="title">GetAdmin</span><span class="params">(LPCSTR Param, <span class="type">int</span> Showcmd)</span><span class="comment">//一个参数是程序运行时的参数，另一个是启动窗口的状态</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">IsProcessRunAsAdmin</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    TCHAR Path[MAX_PATH];</span><br><span class="line">    <span class="built_in">ZeroMemory</span>(Path, MAX_PATH);</span><br><span class="line">    ::<span class="built_in">GetModuleFileName</span>(<span class="literal">NULL</span>, Path, MAX_PATH);           <span class="comment">//获取程序路径</span></span><br><span class="line">    HINSTANCE res;</span><br><span class="line">    res = <span class="built_in">ShellExecute</span>(<span class="literal">NULL</span>, <span class="string">&quot;runas&quot;</span>, Path, <span class="literal">NULL</span>, <span class="literal">NULL</span>, Showcmd);</span><br><span class="line">    <span class="keyword">if</span>(res &gt; (HINSTANCE)<span class="number">32</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">short</span> ret=<span class="number">0</span>; </span><br><span class="line">	ret=<span class="built_in">GetAdmin</span>(<span class="string">&quot;calc&quot;</span>,SW_SHOW);</span><br><span class="line">	<span class="keyword">if</span>(ret!=<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">&quot;wrong&quot;</span>); </span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,argv[<span class="number">1</span>]); </span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="SetWindowsHookExW-钩取流程"><a href="#SetWindowsHookExW-钩取流程" class="headerlink" title="SetWindowsHookExW - 钩取流程"></a>SetWindowsHookExW - 钩取流程</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HHOOK <span class="title function_">SetWindowsHookExW</span><span class="params">(</span></span><br><span class="line"><span class="params">  <span class="type">int</span>       idHook, <span class="comment">//处理的类型?键盘类型</span></span></span><br><span class="line"><span class="params">  HOOKPROC  lpfn, <span class="comment">//自定义的KeyboardProc函数</span></span></span><br><span class="line"><span class="params">  HINSTANCE hmod, <span class="comment">//是装载dll还是卸载dll</span></span></span><br><span class="line"><span class="params">  DWORD     dwThreadId  <span class="comment">//是钩取某个线程还是hook所有的线程</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>

<ol>
<li>int hook——指定事件的钩子ID，如键盘事件WH_KEYBOARD。设置后只对键盘输入起反应。</li>
<li>HOOKPROC lpfn——钩子的处理函数，若设置的是键盘输入钩子，必须是微软定义的一个叫KeyboardProc的函数。</li>
<li>HINSTANCE hmod——模块句柄，因此一般设置钩子的地方在DLL中。</li>
<li>DWORD dwThreadId——需要设置钩子的线程ID，倘若为0则为全局钩子（所有程序都钩）。</li>
</ol>
<h3 id="TOKEN-PRIVILEGES"><a href="#TOKEN-PRIVILEGES" class="headerlink" title="TOKEN_PRIVILEGES"></a>TOKEN_PRIVILEGES</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_TOKEN_PRIVILEGES</span> &#123;</span><br><span class="line">  DWORD               PrivilegeCount; <span class="comment">///下一个数组元素的个数</span></span><br><span class="line">  LUID_AND_ATTRIBUTES Privileges[ANYSIZE_ARRAY];  <span class="comment">//数组.类型为LUID_AND_ATTRIBUTES</span></span><br><span class="line">&#125; TOKEN_PRIVILEGES, *PTOKEN_PRIVILEGES;</span><br></pre></td></tr></table></figure>





<h3 id="URLDownloadToFile"><a href="#URLDownloadToFile" class="headerlink" title="URLDownloadToFile"></a>URLDownloadToFile</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HRESULT <span class="title">URLDownloadToFile</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">             LPUNKNOWN            pCaller,<span class="comment">//如果调用应用程序不是 ActiveX 组件，则可以将此值设置为NULL</span></span></span></span><br><span class="line"><span class="params"><span class="function">             LPCTSTR              szURL, <span class="comment">//指向包含要下载的 URL 的字符串值的指针。</span></span></span></span><br><span class="line"><span class="params"><span class="function">    									<span class="comment">//不能设置为NULL。如果 URL 无效，则返回 INET_E_DOWNLOAD_FAILURE</span></span></span></span><br><span class="line"><span class="params"><span class="function">             LPCTSTR              szFileName,<span class="comment">//指向字符串值的指针，该字符串值包含要为下载创建的文件的名称</span></span></span></span><br><span class="line"><span class="params"><span class="function">    										<span class="comment">//或完整路径。如果szFileName包含路径，则目标目录必须已经存在</span></span></span></span><br><span class="line"><span class="params"><span class="function">  _Reserved_ DWORD                dwReserved,<span class="comment">//保留。必须设置为 0。</span></span></span></span><br><span class="line"><span class="params"><span class="function">             LPBINDSTATUSCALLBACK lpfnCB</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>

<p>此函数可以返回这些值之一。</p>
<table>
<thead>
<tr>
<th align="left">返回码</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>S_OK</strong></td>
<td align="left">下载成功开始。</td>
</tr>
<tr>
<td align="left"><strong>E_OUTOFMEMORY</strong></td>
<td align="left">缓冲区长度无效，或内存不足，无法完成操作。</td>
</tr>
<tr>
<td align="left"><strong>INET_E_DOWNLOAD_FAILURE</strong></td>
<td align="left">指定的资源或回调接口无效。</td>
</tr>
</tbody></table>
<h1 id="字节转化"><a href="#字节转化" class="headerlink" title="字节转化"></a>字节转化</h1><p>WideCharToMultiByte 宽字节到多字节</p>
<p>将 UTF-16（宽字符）字符串映射到新字符串。新字符串不一定来自多字节字符集</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">WideCharToMultiByte</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            UINT                               CodePage,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            DWORD                              dwFlags,</span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            _In_NLS_string_(cchWideChar)LPCWCH lpWideCharStr,  <span class="comment">//指向将被转换的unicode字符串</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            <span class="type">int</span>                                cchWideChar,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="comment">//指定由参数lpWideCharStr指向的缓冲区的字符个数。如果这个值为-1，字符串将被设定为以NULL为结束符的字符串，并且自动计算长度</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [out, optional] LPSTR                              lpMultiByteStr, <span class="comment">//指向接收被转换字符串的缓冲区</span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in]            <span class="type">int</span>                                cbMultiByte,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="comment">//指定由参数lpMultiByteStr指向的缓冲区最大值（用字节来计量）。若此值为零，函数返回lpMultiByteStr指向的目标缓冲区所必需的字节数，在这种情况下，lpMultiByteStr参数通常为NULL。  </span></span></span></span><br><span class="line"><span class="params"><span class="function">  [in, optional]  LPCCH                              lpDefaultChar,</span></span></span><br><span class="line"><span class="params"><span class="function">  [out, optional] LPBOOL                             lpUsedDefaultChar</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>



<p>多字节到宽字节MultiByteToWideChar</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MultiByteToWideChar(CP_ACP, 0, filename, strlen(filename) + 1, name, sizeof(name) / sizeof(name[0]));</span><br><span class="line">//把filename字符串转换到name字符串</span><br></pre></td></tr></table></figure>






    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/re4mile.github.io/tags/Win32/" rel="tag"># Win32</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/re4mile.github.io/2023/01/11/language/C/win32/%E5%B0%8F%E4%B8%93%E9%A2%98/%E7%BE%8E%E5%8C%96/language/" rel="prev" title="win32篇-美化">
                  <i class="fa fa-chevron-left"></i> win32篇-美化
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/re4mile.github.io/2023/01/11/language/C/%E5%9F%BA%E7%A1%80/language/" rel="next" title="C语言">
                  C语言 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">re4mile(邓渠香)</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/re4mile.github.io/js/comments.js"></script><script src="/re4mile.github.io/js/utils.js"></script><script src="/re4mile.github.io/js/motion.js"></script><script src="/re4mile.github.io/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/re4mile.github.io/js/third-party/search/local-search.js"></script>





  





</body>
</html>
